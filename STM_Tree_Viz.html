<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>STM Graph</title>

    <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Roboto|Raleway:600,400,200' rel='stylesheet' type='text/css'>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
    
    <script src="data.js"></script>
    <link rel="stylesheet" href="./css.css">
    <style>
      div.settings-label{font-size:12px;color:#bbb;font-style:italic;margin-top:-10px;margin-bottom:40px;font-weight:300}div.tooltip{position:absolute;text-align:left;padding:10px;border:1px solid #d5d5d5;font-family:arial,helvetica,sans-serif;font-size:1.1em;color:#333;padding:10px;border-radius:3px;background:#fff;color:#000;box-shadow:0 1px 5px rgba(0,0,0,.4);-moz-box-shadow:0 1px 5px rgba(0,0,0,.4);border:1px solid rgba(200,200,200,.85)}.sidebar{position:absolute;text-align:left;padding:10px;border-right:1px solid #d5d5d5;font-family:arial,helvetica,sans-serif;font-size:1.1em;color:#333;padding:10px;background:#fff;color:#000;box-shadow:0 1px 5px rgba(0,0,0,.4);-moz-box-shadow:0 1px 5px rgba(0,0,0,.4)}.sidebar-item{direction:ltr}.sidebar-rule{height:1px;margin:1px auto 3px;margin-top:7px;margin-bottom:7px;background:#ccc;width:10em}.header-rule{height:1px;margin:1px auto 3px;margin-top:7px;margin-bottom:7px;background:#ccc;width:16em}.header-rule-short{height:1px;margin:1px auto 3px;margin-top:7px;margin-bottom:7px;background:#ccc;width:6em}.header0{color:#000;font-size:.7em;margin-bottom:2px;text-align:center;font-style:oblique}.header1{color:#000;font-size:.8em;margin-bottom:2px;text-align:center}.header2{text-align:left;font-size:.7em;margin-bottom:2px;color:#666;text-align:center}.header3{color:#333;text-align:left;font-size:13px;font-style:italic;text-align:center}.thoughts{color:#333;text-align:left;opacity:1 font-size:.7em;text-align:center;transition:.7s ease;font-size:16px}.overlay-text{color:#000;font-size:16px;font-weight:700;opacity:0;position:absolute;transition:.7s ease;width:90%;top:45%;left:50%;transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);text-align:center}.thought-container{position:relative;margin:7.5px 8px 0 8px}.thought-container:hover .thoughts{opacity:.15}.thought-container:hover .overlay-text{opacity:1}
    </style>
    <!-- css -->
    <style>*,::after,::before{background-repeat:no-repeat;box-sizing:inherit}::after,::before{text-decoration:inherit;vertical-align:inherit}html{box-sizing:border-box;cursor:default;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}article,aside,footer,header,nav,section{display:block}body{margin:0}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}nav ol,nav ul{list-style:none}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}::-moz-selection{background-color:#b3d4fc;color:#000;text-shadow:none}::selection{background-color:#b3d4fc;color:#000;text-shadow:none}audio,canvas,iframe,img,svg,video{vertical-align:middle}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg{fill:currentColor}svg:not(:root){overflow:hidden}table{border-collapse:collapse}button,input,optgroup,select,textarea{margin:0}button,input,select,textarea{color:inherit;font-family:inherit;font-size:inherit;line-height:inherit}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto;resize:vertical}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}template{display:none}[tabindex],a,area,button,input,label,select,summary,textarea{-ms-touch-action:manipulation;touch-action:manipulation}[hidden]{display:none}[aria-busy=true]{cursor:progress}[aria-controls]{cursor:pointer}[aria-hidden=false][hidden]:not(:focus){clip:rect(0,0,0,0);display:inherit;position:absolute}[aria-disabled],[disabled]{cursor:default}.vz-weighted_tree-node text{stroke:#777;stroke-opacity:.5}html{background:#fff;font:120% sans-serif}.scrollbox{background:linear-gradient(white 30%,hsla(0,0%,100%,0)),linear-gradient(hsla(0,0%,100%,0) 10px,#fff 70%) bottom,radial-gradient(at top,rgba(0,0,0,.2),transparent 70%),radial-gradient(at bottom,rgba(0,0,0,.2),transparent 70%) bottom;background-repeat:no-repeat;background-size:100% 20px,100% 20px,100% 10px,100% 10px;background-attachment:local,local,scroll,scroll}.z-depth-2{box-shadow:0 8px 17px 0 rgba(0,0,0,.2),0 6px 20px 0 rgba(0,0,0,.19)}.z-depth-3{box-shadow:0 12px 15px 0 rgba(0,0,0,.24),0 17px 50px 0 rgba(0,0,0,.19)}.modal,.z-depth-4{box-shadow:0 16px 28px 0 rgba(0,0,0,.22),0 25px 55px 0 rgba(0,0,0,.21)}.z-depth-5{box-shadow:0 27px 24px 0 rgba(0,0,0,.2),0 40px 77px 0 rgba(0,0,0,.22)}body{margin:0}@media only screen{main{padding-left:210px}}@media only screen and (max-width:961px){main{padding-left:0}}#viz_container{margin:0 auto;padding-top:0}div.container{width:100%;position:absolute;top:100px}.tile{font-family:Raleway;font-weight:300}.heading{font-family:Raleway;font-weight:300}.side-nav li:hover{background-color:#fff}.leftAxis{font-weight:200}.datatip-value{position:absolute;right:10px}.title{font-family:Roboto;font-size:20px;font-weight:200}.vizuly{font-family:Raleway}svg{border-radius:4px;shape-rendering:crispEdges}.vz-data-point{fill-opacity:1;stroke-width:1px;stroke-opacity:1}.vz-tip-hover{font-weight:300}.vz-tip-hover text{opacity:.8}.my-tip{font-family:Raleway;font-weight:300;text-anchor:middle}[type=radio]:checked+label:after{background-color:#448aff;border-color:#3864c9}[type=radio]+label{border-color:#3864c9}.input-field{margin-left:0;padding-bottom:5px;font-family:Roboto}.dropdown-content{font-family:Roboto;font-size:.5em}.dropdown-content li span{font-family:Roboto;font-size:1.75em}div.input-field label{margin-left:-10px}.mdi-navigation-menu{font-size:30px;color:#444}i.mdi-navigation-menu:before{font-size:40px;content:"\e662"}i.mdi-navigation-menu:hover{transition:color .5s ease;color:#0176b4}#myDataTip{font-family:Raleway;line-height:18px}svg.vizuly path.domain{fill:none}.vizuly{fill:#aaa;shape-rendering:auto}.vz-plot-background{fill:#fff}.vz-bar{stroke:#eee;shape-rendering:auto}.vz-area{fill-opacity:.7;shape-rendering:auto}.vz-line{stroke:#777;stroke-width:1px;stroke-opacity:1;fill:none;shape-rendering:auto}.vz-tip{stroke:1px;fill:none;stroke:#777;stroke-opacity:1;shape-rendering:auto}.vz-line-indicator{stroke:#555;stroke-width:1px}.vz-data-point{shape-rendering:auto}.vz-bottomAxis{shape-rendering:crispEdges}.vz-radial-axis-tick{font-weight:300}.vz-skin-axiis{background-image:linear-gradient(to bottom,#d0d0d0,#dfdfdf,#f3f3f3,#d0d0d0);border-radius:5px;border:1px solid #bbb}.vz-skin-ocean{background-image:url(img/vz-skin-galaxy_2.jpg);background-repeat:no-repeat;background-size:cover;border-radius:5px}.vz-axiis-datatip{background:rgba(232,232,232,.9);border-radius:3px;border:1px solid #aaa;fill:#fff;padding:10px;font-face:Raleway;text-transform:uppercase;font-weight:200;color:#000}.vz-material-datatip{background:rgba(35,35,35,.7);border-radius:3px;border:1px solid #aaa;fill:#fff;padding:10px;font-face:Raleway;text-transform:uppercase;font-weight:200;color:#fff}.vz-neon-datatip{background:rgba(106,106,106,.7);border-radius:3px;border:1px solid #777;padding:10px;font-face:Raleway;text-transform:uppercase;font-weight:200;color:#fff}.vz-minimal-datatip{background:rgba(220,220,220,1);border-radius:1px;border:1px solid #333;padding:10px;font-face:Raleway;text-transform:uppercase;color:#333}.vz-minimal-datatip span{font-weight:300!important}.vz-viz circle{shape-rendering:auto}.vz-skin-political-influence{background-color:#eee;border-radius:5px}svg{fill:#fff}i.mdi-navigation-menu:before{font-size:40px;content:"\e662"}i.mdi-navigation-menu:hover{transition:color .5s ease;color:#0176b4}div.vz-weighted_tree-viz{overflow:hidden}.vz-weighted_tree-viz circle{fill:#09f;fill-opacity:1}# change me html{overflow:auto}.vz-weighted_tree-viz{overflow:auto;width:100%;height:100%}.vz-background{overflow:auto}.vz-weighted_tree-viz text{fill:#000}.vz-weighted_tree-viz path{stroke:#777;stroke-opacity:.5}.vz-skin-fire .vz-radial_progress-track{fill-opacity:.1}svg.vz-weighted_tree-viz{fill:none;font-family:Roboto;pointer-events:visible;opacity:1}div.radial_container{float:left;position:relative;top:45%;transform:translateY(-50%)}#viz_container{border-radius:6px}</style>
    <!-- js -->
    <script>var vizuly={};vizuly.version="1.0",vizuly.core={},vizuly.viz={},vizuly.viz.layout={},vizuly.viz.layout.CLUSTERED="CLUSTERED",vizuly.viz.layout.STACKED="STACKED",vizuly.viz.layout.OVERLAP="OVERLAP",vizuly.viz.layout.STREAM="STREAM",vizuly.svg={},vizuly.theme={},vizuly.skin={},vizuly.ui={},vizuly.core.component=function(a,b,c,d){function e(a,b,c){Object.getOwnPropertyNames(c).forEach(function(d,e,f){"undefined"==typeof b[d]&&(b[d]=c[d],a[d]=function(c){if(!arguments.length)return b[d];var e=b[d];return b[d]=c,b[d]!==e&&b.dispatch[d+"_change"].apply(this,[b[d],e]),a})})}b.parent=a,b.properties=c,b.id=vizuly.core.util.guid(),b.selection=d3.select(a).append("div").attr("id","div_"+b.id).style("width","100%").style("height","100%");var f=[];f.push("mouseover"),f.push("mouseout"),f.push("mousedown"),f.push("click"),f.push("dblclick"),f.push("touch"),f.push("zoom"),f.push("zoomstart"),f.push("zoomend"),f.push("initialize"),f.push("validate"),f.push("measure"),f.push("update"),Object.getOwnPropertyNames(c).forEach(function(a,b,c){f.push(a+"_change")}),d&&d.length>0&&d.forEach(function(a){f.push(a)}),b.dispatch=d3.dispatch.apply(this,f);var g=function(){return e(g,b,b.properties),g};return b.dispatch.component=g(),g.id=function(){return b.id},g.selection=function(){return b.selection},g.on=function(a,c){return b.dispatch.on(a,c),g},g.validate=function(){if(!a){var a=[];if(Object.getOwnPropertyNames(c).forEach(function(c){!b[c]&&Number(0!=b[c])&&a.push(c)}),a.length>0)throw new Error("vizuly.core.util.component.validate(): "+a.concat()+" need to be declared");b.dispatch.validate()}},b.dispatch.component},vizuly.core.util={},vizuly.core.util.size=function(a,b,c){var d={};return d.width=b-vizuly.core.util.measure(a.left,b)-vizuly.core.util.measure(a.right,b),d.height=c-vizuly.core.util.measure(a.top,c)-vizuly.core.util.measure(a.bottom,c),d.top=vizuly.core.util.measure(a.top,c),d.left=vizuly.core.util.measure(a.left,b),d.bottom=vizuly.core.util.measure(a.bottom,c),d.right=vizuly.core.util.measure(a.right,b),d},vizuly.core.util.getTypedScale=function(a){var b;return b="string"==typeof a?d3.scale.ordinal():a instanceof Date?d3.time.scale():d3.scale.linear()},vizuly.core.util.setRange=function(a,b,c){"string"==typeof a.domain()[0]?a.rangeBands([b,c],0):a.range([b,c])},vizuly.core.util.measure=function(a,b){if("string"==typeof a&&"%"==a.substr(a.length-1)){var c=Math.min(Number(a.substr(0,a.length-1)),100)/100;return Math.round(b*c)}return a},vizuly.core.util.guid=function(){return"vzxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)})},vizuly.core.util.getDefs=function(a){var b=a.selection().selectAll("svg defs");return b[0].length<1&&(b=a.selection().select("svg").append("defs")),b},vizuly.core.util.createCSSKey=function(a){return a=String(a).replace(",","_"),a=a.replace(/[\s+,'+,\.,\(,\),\"]/g,""),a="css"+a.toUpperCase()},vizuly.core.util.aggregateNest=function(a,b,c){function d(a,b){if(b)for(var c=0;c<g.length;c++){var d=g[c];void 0!=a[d]&&(a["childProp_"+d]=a[d]),b["childProp_"+d]=a["childProp_"+d]?a["childProp_"+d]:a[d]}}function e(a,f){for(var g=0;g<a.length;g++){var h=a[g];if(h.values){e(h.values,h);for(var i=0;i<h.values.length;i++)for(var j=h.values[i],k=0;k<b.length;k++)isNaN(h["agg_"+b[k]])&&(h["agg_"+b[k]]=0),h["agg_"+b[k]]=c(h["agg_"+b[k]],j["agg_"+b[k]])}else for(var k=0;k<b.length;k++)h["agg_"+b[k]]=Number(h[b[k]]),isNaN(h["agg_"+b[k]])&&(h["agg_"+b[k]]=0);d(h,f)}}for(var f=a[0];f.values;)f=f.values[0];var g=[];Object.getOwnPropertyNames(f).forEach(function(a){g.push(a)}),e(a)},vizuly.core.util.format_YEAR_Mon_MonDay=d3.time.format.multi([[".%L",function(a){return a.getMilliseconds()}],[":%S",function(a){return a.getSeconds()}],["%I:%M",function(a){return a.getMinutes()}],["%I %p",function(a){return a.getHours()}],["%a %d",function(a){return a.getDay()&&1!=a.getDate()}],["%b %d",function(a){return 1!=a.getDate()}],["%b",function(a){return a.getMonth()}],["20%y",function(a){return!0}]]),vizuly.svg.filter={},vizuly.svg.filter.dropShadow=function(a,b,c,d){var e=Math.round(100*b)+"_"+Math.round(100*c)+"_"+Math.round(100*dev),f=a.id(),g=vizuly.core.util.getDefs(a),h=g.selectAll("#vz_filter_"+f+"_"+e).data([e]).enter().append("filter").attr("id","vz_filter_"+f+"_"+e).attr("class","vz-svg-filter-dropShadow").attr("width","300%").attr("height","300%");h.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",d),h.append("feOffset").attr("dx",b).attr("dy",c),h.append("feComponentTransfer").append("feFuncA").attr("type","linear").attr("slope",.2);var i=h.append("feMerge");return i.append("feMergeNode"),i.append("feMergeNode").attr("in","SourceGraphic"),"#vz_filter_"+f+"_"+e},vizuly.svg.gradient={},vizuly.svg.gradient.blend=function(a,b,c,d){var e,f,g,h,i=String(b).replace("#","")+String(c).replace("#",""),j="vz_gradient_blend_"+a.id()+"_"+i;"horizontal"==d?(e="100%",f="0%",g="0%",h="0%"):(e="0%",f="0%",g="100%",h="0%");var k=vizuly.core.util.getDefs(a),l=k.selectAll("#"+j).data([i]).enter().append("linearGradient").attr("id",j).attr("class","vz-svg-gradient-blend").attr("x1",e).attr("x2",f).attr("y1",g).attr("y2",h);return l.append("stop").attr("offset","0%").attr("stop-color",b),l.append("stop").attr("offset","100%").attr("stop-color",c),l=k.selectAll("#"+j)},vizuly.svg.gradient.fade=function(a,b,c,d,e){e||(e=[0,1]),d||(d=[.75,.9]);var f,g,h,i,j=String(b).replace("#",""),k="vz_gradient_fade_"+a.id()+"_"+j;"horizontal"==c?(f="0%",g="100%",h="0%",i="0%"):(f="0%",g="0%",h="100%",i="0%");var l=vizuly.core.util.getDefs(a),m=l.selectAll("#"+k).data([j]).enter().append("linearGradient").attr("id",k).attr("class","vz-svg-gradient-fade").attr("x1",f).attr("x2",g).attr("y1",h).attr("y2",i);return m.append("stop").attr("offset",100*e[0]+"%").attr("stop-color",b).attr("stop-opacity",d[0]),m.append("stop").attr("offset",100*e[1]+"%").attr("stop-color",b).attr("stop-opacity",d[1]),m=l.selectAll("#"+k)},vizuly.svg.gradient.radialFade=function(a,b,c,d){d||(d=[0,1]),c||(c=[.75,.9]);var e=String(b).replace("#",""),f="vz_gradient_radial_fade"+a.id()+"_"+e,g=vizuly.core.util.getDefs(a),h=g.selectAll("#"+f).data([e]).enter().append("radialGradient").attr("id",f).attr("class","vz-svg-gradient-radial-fade");return h.append("stop").attr("offset",100*d[0]+"%").attr("stop-color",b).attr("stop-opacity",c[0]),h.append("stop").attr("offset",100*d[1]+"%").attr("stop-color",b).attr("stop-opacity",c[1]),h=g.selectAll("#"+f)},vizuly.svg.gradient.darker=function(a,b,c){var d,e,f,g,h=String(b).replace("#",""),i="vz_gradient_darker_"+a.id()+"_"+h;"horizontal"==c?(d="100%",e="0%",f="0%",g="0%"):(d="0%",e="0%",f="100%",g="0%");var j=vizuly.core.util.getDefs(a),k=j.selectAll("#"+i).data([h]).enter().append("linearGradient").attr("class","vz-gradient-darker").attr("id",i).attr("x1",d).attr("x2",e).attr("y1",f).attr("y2",g);return k.append("stop").attr("offset","0%").attr("stop-color",b).attr("stop-opacity",.75),k.append("stop").attr("offset","100%").attr("stop-color",d3.rgb(b).darker()).attr("stop-opacity",.9),k=j.selectAll("#"+i)},vizuly.svg.text={},vizuly.svg.text.arcPath=function(a,b){var c=.0174533,d={};d.angle=b,d.startAngle=d.angle-179*c,d.endAngle=d.angle+179*c;var e=d3.svg.arc().innerRadius(r).outerRadius(a)(d),f=/[Mm][\d\.\-e,\s]+[Aa][\d\.\-e,\s]+/,g=f.exec(e);return g&&(g=g[0]),g},vizuly.svg.text.wrap=function(a,b,c,d){d=!d&&a.attr("width")?Number(a.attr("width")):d,a.each(function(){var a=d3.select(this);a.selectAll("tspan").remove();var e,f=b.split(/\s+/).reverse(),g=[],h=0,i=a.attr("x"),j=a.attr("y"),k=parseFloat(c);isNaN(k)&&(k=0);for(var l=a.text(null).append("tspan").attr("x",i).attr("y",j).attr("dy","0px");e=f.pop();)g.push(e),l.text(g.join(" ")),l.node().getComputedTextLength()>d&&(h++,g.pop(),l.text(g.join(" ")),g=[e],l=a.append("tspan").attr("class","vz-multi-line").attr("x",i).attr("y",j).attr("dy",+k+"px").text(e),k+=c)})},vizuly.skin.COLUMNBAR_AXIIS="Axiis",vizuly.skin.COLUMNBAR_NEON="Neon",vizuly.skin.COLUMNBAR_MATERIALBLUE="MaterialBlue",vizuly.skin.COLUMNBAR_MATERIALPINK="MaterialPink",vizuly.theme.column_bar=function(a){function b(){l(),"viz.chart.column"==a.type?(m=".vz-left-axis",n=".vz-bottom-axis"):(n=".vz-left-axis",m=".vz-bottom-axis")}function c(){var b=a.width(),c=a.selection();o=Math.max(8,Math.round(a.width()/65)),c.attr("class",s["class"]),c.selectAll(n+" .tick text").style("font-weight",s.ordinalAxis_font_weight).style("fill",s.labelColor).style("fill-opacity",1).style("font-size",o+"px").style("opacity",function(){return b>399?1:0}),c.selectAll(m+" line").style("stroke",s.valueAxis_line_stroke).style("stroke-width",1).style("opacity",s.valueAxis_line_opacity),c.selectAll(m+" text").style("font-size",o+"px").style("fill",s.labelColor).style("fill-opacity",.8);var d=c.selectAll(".vz-plot .vz-bar").style("stroke","#FFF");a.layout()==vizuly.viz.layout.STACKED?d.style("stroke-opacity",1).style("stroke-width",function(){return b/800+"px"}).style("stroke-opacity",.6):d.style("stroke-opacity",s.bar_stroke_opacity),c.selectAll(".vz-bar-group")[0].forEach(function(a,b){d3.select(a).selectAll("rect.vz-bar").attr("filter",function(a,b){return s.bar_filter(a,b)}).style("fill-opacity",function(a,b){return s.bar_fill_opacity(a,b)}).style("fill",function(a,b){return s.bar_fill(a,b)}).style("rx",s.barRadius)}),s.background_transition()}function d(b,c,d){d3.select(b).style("fill",s.bar_mouseover_fill).style("fill-opacity",s.bar_mouseover_opacity).style("stroke",s.bar_mouseover_stroke).attr("filter",s.bar_filter_over()),d3.select(a.selection().selectAll(n+" .tick text")[0][g(c)]).transition().style("font-size",1.2*o+"px").style("font-weight",700).style("fill",s.color).style("text-decoration","underline").style("fill-opacity",1).style("opacity",1)}function e(b,c,d){d3.select(b).style("fill",function(){return s.bar_fill(c,d)}).style("fill-opacity",function(){return s.bar_fill_opacity(c,d)}).style("stroke","#FFF").attr("filter",s.bar_filter()),d3.select(a.selection().selectAll(n+" .tick text")[0][g(c)]).transition().style("font-size",o+"px").style("fill",s.labelColor).style("font-weight",s.ordinalAxis_font_weight).style("text-decoration",null).style("fill-opacity",1).style("opacity",function(){return a.width()>399?1:0})}function f(){a.selection().selectAll(".vz-tip").remove(),"viz.chart.column"==a.type?a.yAxis().tickSize(-vizuly.core.util.size(a.margin(),a.width(),a.height()).width).ticks(5).orient("left"):a.xAxis().tickSize(-vizuly.core.util.size(a.margin(),a.width(),a.height()).height).ticks(5)}function g(b){return(m=".vz-left-axis")?a.xScale().domain().indexOf(a.y().apply(this,[b])):a.yScale().domain().indexOf(a.x().apply(this,[b]))}function h(){var b=a.width();return"url("+vizuly.svg.filter.dropShadow(a,b/300,b/300,b/200)+")"}function i(){var b=a.width();return"url("+vizuly.svg.filter.dropShadow(a,b/100,b/100,1.5)+")"}function j(){a.selection().selectAll(".vz-background").style("fill-opacity",1),a.selection().selectAll(".vz-background").attr("fill",function(){return"url(#"+r.attr("id")+")"}),r.selectAll("stop").transition().duration(500).attr("stop-color",function(a,b){return 0==b?s.grad0:s.grad1})}function k(a,b){return a="0x"+a.replace("#",""),a=parseInt(a,16),a+=65793,a|=b,"#"+a.toString(16)}function l(){q.forEach(function(b){a.on(b.on,b.callback)})}var m,n,o,p={MaterialBlue:{name:"Material Blue",labelColor:"#FFF",color:"#02C3FF",grad0:"#021F51",grad1:"#039FDB",background_transition:j,bar_filter:function(a,b){return h()},bar_filter_over:function(a,b){return i()},bar_fill:function(a,b){return"#02C3FF"},bar_fill_opacity:function(a,b){return 1-b/4},bar_mouseover_stroke:"#02C3FF",bar_mouseover_fill:"#FFF",bar_stroke_opacity:0,bar_mouseover_opacity:1,ordinalAxis_font_weight:200,valueAxis_line_stroke:"#FFF",valueAxis_line_opacity:.25,barRadius:function(){return 0},datatip_class:"vz-material-datatip","class":"vz-skin-default"},MaterialPink:{name:"Material Pink",labelColor:"#FFF",color:"#F553B1",grad0:"#540936",grad1:"#C12780",background_transition:j,bar_filter:function(a,b){return h()},bar_filter_over:function(a,b){return i()},bar_fill:function(a,b){return"#FF35BE"},bar_fill_opacity:function(a,b){return 1-b/4},bar_stroke_opacity:0,bar_mouseover_stroke:"#FF35BE",bar_mouseover_fill:"#FFF",bar_mouseover_opacity:.9,ordinalAxis_font_weight:200,valueAxis_line_stroke:"#FFF",valueAxis_line_opacity:.25,barRadius:function(){return 0},datatip_class:"vz-material-datatip","class":"vz-skin-default"},Neon:{name:"Neon",labelColor:"#FFF",color:"#D1F704",grad0:"#000000",grad1:"#474747",background_transition:j,bar_filter:function(a,b){return null},bar_filter_over:function(a,b){return i()},bar_fill:function(a,b){return"#D1F704"},bar_fill_opacity:function(a,b){return 1-b/6},bar_stroke_opacity:0,bar_mouseover_stroke:"#D1F704",bar_mouseover_fill:"#FFF",bar_mouseover_opacity:1,ordinalAxis_font_weight:200,valueAxis_line_stroke:"#FFF",valueAxis_line_opacity:.25,barRadius:function(){return a.width()/150},datatip_class:"vz-neon-datatip","class":"vz-skin-default"},Axiis:{name:"Axiis",labelColor:"#444",color:"#000",colorScale:d3.scale.linear().range(["#DF1133","#3333DF"]).domain([0,a.data()[0].length]),background_transition:function(){a.selection().select(".vz-background").transition().style("fill-opacity",0)},bar_filter:function(a,b){return null},bar_filter_over:function(a,b){return null},bar_fill:function(b,c){var d=vizuly.svg.gradient.fade(a,k(this.colorScale(a.xScale().domain().indexOf(a.x().apply(this,[b]))),2245632*c));return"url(#"+d.attr("id")+")"},bar_fill_opacity:function(a,b){return 1-b/4},bar_mouseover_stroke:"#AAA",bar_mouseover_fill:"#000",bar_mouseover_opacity:.8,bar_stroke_opacity:1,ordinalAxis_font_weight:400,valueAxis_line_stroke:"#AAA",valueAxis_line_opacity:1,barRadius:function(){return 0},datatip_class:"vz-axiis-datatip","class":"vz-skin-axiis"},Minimal:{name:"Minimal",labelColor:"#444",color:"#333",grad0:"#F0F0F0",grad1:"#F0F0F0",background_transition:j,bar_filter:function(a,b){return null},bar_filter_over:function(a,b){return null},bar_fill:function(a,b){return"#555"},bar_fill_opacity:function(a,b){return 1-b/4},bar_stroke_opacity:0,bar_mouseover_stroke:"#000",bar_mouseover_fill:"#333",bar_mouseover_opacity:1,ordinalAxis_font_weight:400,valueAxis_line_stroke:"#AAA",valueAxis_line_opacity:.35,barRadius:function(){return 0},datatip_class:"vz-minimal-datatip","class":"vz-skin-default"}},a=a,q=[{on:"measure.theme",callback:f},{on:"update.theme",callback:c},{on:"mouseover.theme",callback:d},{on:"mouseout.theme",callback:e}];b();var r=vizuly.svg.gradient.blend(a,"#000","#000");b.apply=function(a){return arguments.length>0&&b.skin(a),c(),b},b.release=function(){a&&(a.selection().attr("class",null),q.forEach(function(b){a.on(b.on,null)}),a=null)},b.viz=function(b){return arguments.length?(a=b,void l()):a};var s=null;return b.skin=function(a){if(0==arguments.length)return s;if(!p[a])throw new Error("theme/column_bar.js - skin "+a+" does not exist.");return s=p[a],b},b.skins=function(){return p},b},vizuly.skin.LINEAREA_AXIIS="Axiis",vizuly.skin.LINEAREA_NEON="Neon",vizuly.skin.LINEAREA_FIRE="Fire",vizuly.skin.LINEAREA_OCEAN="Ocean",vizuly.skin.LINEAREA_SUNSET="Sunset",vizuly.skin.LINEAREA_BUSINESS="Business",vizuly.theme.radial_linearea=function(a){function b(){h()}function c(){if(i){var b=a.selection();b.attr("class",i["class"]),b.selectAll(".vz-background").attr("fill",function(){return"url(#"+j.attr("id")+")"}),b.selectAll(".vz-plot-background").style("opacity",0),b.selectAll(".vz-area").style("fill",function(a,b){return i.area_fill(a,b)}).style("fill-opacity",function(b,c){return i.area_fill_opacity.apply(a,[b,c])}),b.selectAll(".vz-line").style("stroke-width",function(){return a.outerRadius()/450}).style("stroke",function(a,b){return i.line_stroke(a,b)}).style("opacity",function(b,c){return i.line_opacity.apply(a,[b,c])}),b.selectAll(".vz-data-point").style("opacity",0),b.selectAll(".vz-radial-x-axis-tick").style("font-weight",i.xAxis_font_weight).style("fill",i.labelColor).style("font-weight",300).style("fill-opacity",.4).style("font-size",Math.max(8,Math.round(a.outerRadius()/25))+"px"),b.selectAll(".vz-y-axis-tick").style("stroke",i.yAxis_line_stroke).style("stroke-width",1).style("opacity",i.yAxis_line_opacity),b.selectAll(".vz-y-axis-tick-label").style("font-size",Math.max(8,Math.round(a.outerRadius()/30))+"px").style("fill",i.labelColor).style("font-weight",200).style("fill-opacity",function(){return i===m.Business?1:.4}),i.background_transition()}}function d(b,c,d){a.selection().selectAll(".vz-line").transition().style("stroke-width",function(){return a.outerRadius()/270}).style("stroke",function(a,b){return i.line_over_stroke(a,b)}).style("opacity",function(a,b){return b==d?1:0}),a.selection().selectAll(".vz-area").transition().style("opacity",function(a,b){return b==d?1:.35}),a.selection().selectAll(".vz-plot").append("circle").attr("class","vz-yAxis-mouseover").attr("cx",0).attr("cy",0).attr("r",function(){return a.radiusScale()(b.y+b.y0)}).style("stroke","#FFF").style("fill","none").style("stroke-dasharray",function(){return a.outerRadius()/80+","+a.outerRadius()/80}),a.selection().selectAll(".vz-y-axis-tick").style("opacity",.1),a.selection().selectAll(".vz-point-tip").remove();var e=d3.select(this);e.append("circle").attr("class","vz-point-tip").attr("r",4).style("fill","#000").style("stroke","#FFF").style("stroke-width",2).style("pointer-events","none")}function e(b,c,d){a.selection().selectAll(".vz-line").transition().style("stroke-width",function(){return a.outerRadius()/450}).style("stroke",function(a,b){return i.line_stroke(a,b)}).style("opacity",function(b,c){return i.line_opacity.apply(a,[b,c])}),a.selection().selectAll(".vz-area").transition().style("opacity",1),a.selection().selectAll(".vz-yAxis-mouseover").remove(),a.selection().selectAll(".vz-point-tip").remove(),a.selection().selectAll(".vz-y-axis-tick").style("opacity",i.yAxis_line_opacity)}function f(){a.yAxis().tickSize(a.outerRadius()).ticks(a.layout()==vizuly.viz.layout.OVERLAP?5:7).orient("left")}function g(){a.selection().selectAll(".vz-background").style("fill-opacity",1),j.selectAll("stop").transition().duration(500).attr("stop-color",function(a,b){return 0==b?i.grad0:i.grad1})}function h(){l.forEach(function(b){a.on(b.on,b.callback)})}var a=a,i=null,j=vizuly.svg.gradient.blend(a,"#000","#000"),k=d3.scale.category20(),l=[{on:"measure.theme",callback:f},{on:"update.theme",callback:c},{on:"mouseover.theme",callback:d},{on:"mouseout.theme",callback:e}];b(),b.apply=function(a){return arguments.length>0&&b.skin(a),c(),b},b.release=function(){a&&(a.selection().attr("class",null),l.forEach(function(b){a.on(b.on,null)}),a=null)},b.viz=function(b){return arguments.length?(a=b,void h()):a},b.skin=function(a){if(0==arguments.length)return i;if(!m[a])throw new Error("theme/linearea.js - skin "+a+" does not exist.");return i=m[a],b},b.skins=function(){return m};var m={Fire:{name:"Fire",labelColor:"#FFF",color:"#02C3FF",stroke_colors:["#FFA000","#FF5722","#F57C00","#FF9800","#FFEB3B"],fill_colors:["#C50A0A","#C2185B","#F57C00","#FF9800","#FFEB3B"],grad0:"#000000",grad1:"#474747",background_transition:g,line_stroke:function(a,b){return this.stroke_colors[b%5]},line_over_stroke:function(a,b){return d3.rgb(this.stroke_colors[b%5]).brighter()},line_opacity:function(a,b){return this.layout()==vizuly.viz.layout.STREAM?.4:.6},area_fill:function(b,c){return"url(#"+vizuly.svg.gradient.radialFade(a,this.fill_colors[c%5],[1,.35]).attr("id")+")"},area_fill_opacity:function(a,b){return this.layout()==vizuly.viz.layout.OVERLAP?.7:.9},xAxis_font_weight:200,yAxis_line_stroke:"#FFF",yAxis_line_opacity:.25,"class":"vz-skin-default"},Sunset:{name:"Sunset",labelColor:"#D8F433",color:"#02C3FF",stroke_colors:["#CD57A4","#B236A3","#FA6F7F","#FA7C3B","#E96B6B"],fill_colors:["#89208F","#C02690","#D93256","#DB3D0C","#B2180E"],grad1:"#7D1439",grad0:"#000",background_transition:g,line_stroke:function(a,b){return this.stroke_colors[b%5]},line_over_stroke:function(a,b){return d3.rgb(this.stroke_colors[b%5]).brighter()},line_opacity:function(a,b){return this.layout()==vizuly.viz.layout.STREAM?.4:.9},area_fill:function(b,c){return"url(#"+vizuly.svg.gradient.radialFade(a,this.fill_colors[c%5],[1,.35]).attr("id")+")"},area_fill_opacity:function(a,b){return this.layout()==vizuly.viz.layout.OVERLAP?.8:1},xAxis_font_weight:200,yAxis_line_stroke:"#D8F433",yAxis_line_opacity:.25,"class":"vz-skin-default"},Ocean:{name:"Ocean",labelColor:"#FFF",color:"#02C3FF",stroke_colors:["#001432","#001432","#001432","#001432","#001432"],grad1:"#390E1D",grad0:"#92203A",background_transition:function(b){a.selection().select(".vz-background").transition(1e3).style("fill-opacity",0)},line_stroke:function(a,b){return"#FFF"},line_over_stroke:function(a,b){return"#FFF"},line_opacity:function(a,b){return.3},area_fill:function(b,c){return"url(#"+vizuly.svg.gradient.radialFade(a,"#FFF",[1,.35]).attr("id")+")"},area_fill_opacity:function(a,b){return this.layout()==vizuly.viz.layout.OVERLAP?.2:.7},xAxis_font_weight:200,yAxis_line_stroke:"#FFF",yAxis_line_opacity:.25,"class":"vz-skin-ocean"},Neon:{name:"Neon",labelColor:"#FFF",color:"#02C3FF",stroke_colors:["#FFA000","#FF5722","#F57C00","#FF9800","#FFEB3B"],fill_colors:["#C50A0A","#C2185B","#F57C00","#FF9800","#FFEB3B"],grad0:"#000000",grad1:"#474747",background_transition:g,line_stroke:function(a,b){return"#FFF"},line_over_stroke:function(a,b){return"#FFF"},line_opacity:function(a,b){return this.layout()==vizuly.viz.layout.STREAM?.2:.4},area_fill:function(a,b){return"#D1F704"},area_fill_opacity:function(b,c){var d=d3.scale.linear().range([.1,.8]).domain([0,a.data().length])(c);return this.layout()==vizuly.viz.layout.OVERLAP?.8*d:d},xAxis_font_weight:200,yAxis_line_stroke:"#FFF",yAxis_line_opacity:.25,"class":"vz-skin-default"},Business:{name:"Business",labelColor:"#000",color:"#000",stroke_colors:["#FFA000","#FF5722","#F57C00","#FF9800","#FFEB3B"],fill_colors:["#C50A0A","#C2185B","#F57C00","#FF9800","#FFEB3B"],grad0:"#CCC",grad1:"#CCC",background_transition:g,line_stroke:function(a,b){return d3.rgb(k(b)).darker()},line_over_stroke:function(a,b){return"#FFF"},line_opacity:function(a,b){return.7},area_fill:function(a,b){return k(b)},area_fill_opacity:function(a,b){return this.layout()==vizuly.viz.layout.OVERLAP?.9:.95},xAxis_font_weight:200,yAxis_line_stroke:"#000",yAxis_line_opacity:.25,"class":"vz-skin-default"}};return b},vizuly.skin.HALO_FIRE="Fire",vizuly.skin.HALO_SUNSET="Sunset",vizuly.skin.HALO_NEON="Neon",vizuly.skin.HALO_OCEAN="Ocean",vizuly.theme.halo=function(a){function b(){r()}function c(){if(s&&a){var b=a.selection();b.attr("class",s["class"]),b.selectAll(".vz-background").attr("fill",function(){return"url(#"+t.attr("id")+")"}),b.selectAll(".vz-plot-background").style("opacity",0),b.selectAll(".vz-halo-link-path").style("fill",function(a,b){return s.link_fill(a,b)}).style("fill-opacity",s.link_fill_opacity).style("stroke",function(a,b){return s.link_stroke(a,b)}),b.selectAll(".vz-halo-link-node").style("fill",function(a,b){return s.link_fill(a,b)}).style("fill-opacity",s.link_node_fill_opacity),b.selectAll(".vz-halo-node").style("fill",function(a,b){return s.node_fill(a,b)}).style("stroke",function(a,b){return s.node_stroke(a,b)}).style("stroke-width",function(a,b){return u(a.r)}),b.selectAll(".vz-halo-arc-slice").style("fill",function(a,b){return s.arc_fill(a,b)}),b.selectAll(".vz-halo-arc").style("fill",function(a,b){return s.arc_fill(a,b)}),s.background_transition()}}function d(b,c,d){h(),n(d3.select(b)),i(a.selection().selectAll(".vz-halo-link-path.halo-key_"+c.data.key)),c.data.values.forEach(function(b){k(a.selection().selectAll(".vz-halo-node.node-key_"+a.nodeKey()(b)))})}function e(b,c,d){h(),i(d3.select(b.parentNode).selectAll(".vz-halo-link-path")),n(a.selection().selectAll(".vz-halo-arc.halo-key_"+a.haloKey()(c.data))),m(d3.select(b.parentNode).selectAll(".vz-halo-arc-slice")),j(a.selection().selectAll(".vz-halo-node.node-key_"+a.nodeKey()(c.data))),l(d3.select(b.parentNode).selectAll("circle"))}function f(b,c,d){h();var e=a.selection().selectAll(".vz-halo-link-path.node-key_"+c.key);e.each(function(b){var c=a.selection().selectAll(".vz-halo-arc.halo-key_"+a.haloKey()(b.data));n(c)}),i(e),m(a.selection().selectAll(".vz-halo-arc-slice.node-key_"+c.key)),l(a.selection().selectAll(".vz-halo-node.node-key_"+c.key))}function g(a,b,c){o()}function h(){a.selection().selectAll(".vz-halo-node").style("fill-opacity",.1).style("stroke-opacity",.05),a.selection().selectAll(".vz-halo-link-node").style("fill-opacity",0),a.selection().selectAll(".vz-halo-link-path").style("fill-opacity",.025)}function i(a){a.style("fill-opacity",.6).style("stroke-opacity",.25)}function j(a){a.style("stroke-opacity",.8).style("stroke",function(a,b){return s.node_over_stroke(a,b)})}function k(a){a.style("fill-opacity",.8).style("stroke-opacity",.5).style("stroke",function(a,b){return s.node_over_stroke(a,b)})}function l(a){a.style("fill-opacity",.5).style("stroke-opacity",.7).style("stroke",function(a,b){return s.node_over_stroke(a,b)})}function m(a){a.style("fill-opacity",.8).style("stroke-opacity",.8)}function n(a){a.style("fill-opacity",.65).style("stroke-opacity",.8).style("fill",function(a,b){return s.arc_over_fill(a,b)})}function o(){a.selection().selectAll(".vz-halo-arc").style("fill-opacity",null).style("stroke-opacity",null).style("fill",function(a,b){return s.arc_fill(a,b)}),a.selection().selectAll(".vz-halo-node").style("fill-opacity",null).style("stroke-opacity",null).style("stroke",function(a,b){return s.node_stroke(a,b)}),a.selection().selectAll(".vz-halo-link-node").style("fill-opacity",s.link_node_fill_opacity).style("stroke",null),a.selection().selectAll(".vz-halo-link-path").style("fill-opacity",s.link_fill_opacity).style("stroke-opacity",null),a.selection().selectAll(".vz-halo-arc-slice").style("fill-opacity",null).style("stroke-opacity",null)}function p(){var b=Math.min(a.width(),a.height()/2);u.domain([0,b/20]),u.range([0,b/80])}function q(){a.selection().selectAll(".vz-background").style("fill-opacity",1),t.selectAll("stop").transition().duration(500).attr("stop-color",function(a,b){return 0==b?s.grad0:s.grad1})}function r(){v.forEach(function(b){a.on(b.on,b.callback)})}var a=a,s=null,t=vizuly.svg.gradient.blend(a,"#000","#000"),u=d3.scale.linear(),v=[{on:"measure.theme",callback:p},{on:"update.theme",callback:c},{on:"nodeover.theme",callback:f},{on:"nodeout.theme",callback:g},{on:"arcover.theme",callback:d},{on:"arcout.theme",callback:g},{on:"linkover.theme",callback:e},{on:"linkout.theme",callback:g}];b(),b.apply=function(a){return arguments.length>0&&b.skin(a),c(),b},b.release=function(){a&&(a.selection().attr("class",null),v.forEach(function(b){a.on(b.on,null)}),a=null)},b.viz=function(b){return arguments.length?(a=b,void r()):a},b.skin=function(a){if(0==arguments.length)return s;if(!w[a])throw new Error("theme/linearea.js - skin "+a+" does not exist.");return s=w[a],b},b.skins=function(){return w};var w={Fire:{name:"Fire",labelColor:"#FFF",labelFill:"#C50A0A",stroke_colors:["#FFA000","#FF5722","#F57C00","#FF9800","#FFEB3B"],fill_colors:["#C50A0A","#C2185B","#F57C00","#FF9800","#FFEB3B"],grad0:"#000000",grad1:"#474747",background_transition:q,link_stroke:function(a,b){return this.stroke_colors[b%5]},link_fill:function(a,b){return this.fill_colors[b%5]},link_fill_opacity:.1,link_node_fill_opacity:.1,node_stroke:function(a,b){return this.stroke_colors[b%5]},node_over_stroke:function(a,b){return"#FFF"},node_fill:function(a,b){return this.fill_colors[b%5]},arc_stroke:function(a,b){return"#FFF"},arc_fill:function(a,b){return this.fill_colors[b%5]},arc_over_fill:function(a,b){return"#FFEB3B"},"class":"vz-skin-fire"},Sunset:{name:"Sunset",labelColor:"#FFF",labelFill:"#00236C",stroke_colors:["#CD57A4","#B236A3","#FA6F7F","#FA7C3B","#E96B6B"],fill_colors:["#89208F","#C02690","#D93256","#DB3D0C","#B2180E"],grad0:"#220910",grad1:"#571825",background_transition:q,link_stroke:function(a,b){return this.stroke_colors[b%5]},link_fill:function(a,b){return this.fill_colors[b%5]},link_fill_opacity:.2,link_node_fill_opacity:.5,node_stroke:function(a,b){return this.stroke_colors[b%5]},node_over_stroke:function(a,b){return"#FFF"},node_fill:function(a,b){return this.fill_colors[b%5]},arc_stroke:function(a,b){return"#FFF"},arc_fill:function(a,b){return this.fill_colors[b%5]},arc_over_fill:function(a,b){return"#00236C"},"class":"vz-skin-sunset"},Neon:{name:"Neon",labelColor:"#FFF",labelFill:"#005",grad0:"#000000",grad1:"#474747",background_transition:q,link_stroke:function(a,b){return"#D1F704"},link_fill:function(a,b){return"#D1F704"},link_fill_opacity:.1,link_node_fill_opacity:.1,node_stroke:function(a,b){return"#D1F704"},node_over_stroke:function(a,b){return"#FFF"},node_fill:function(a,b){return"#FFF"},arc_stroke:function(a,b){return"#FFF"},arc_fill:function(a,b){return"#D1F704"},arc_over_fill:function(a,b){return"#03F"},"class":"vz-skin-neon"},Ocean:{name:"Ocean",labelColor:"#FFF",labelFill:"#000",background_transition:function(b){a.selection().select(".vz-background").transition(1e3).style("fill-opacity",0)},link_stroke:function(a,b){return"#FFF"},link_fill:function(a,b){return"#FFF"},link_fill_opacity:.075,link_node_fill_opacity:.075,node_stroke:function(a,b){return"#FFF"},node_over_stroke:function(a,b){return"#FFF"},node_fill:function(a,b){return"#FFF"},arc_stroke:function(a,b){return"#FFF"},arc_fill:function(a,b){return"#FFF"},arc_over_fill:function(a,b){return"#000"},"class":"vz-skin-ocean"}};return b},vizuly.skin.LINEAREA_AXIIS="Axiis",vizuly.skin.LINEAREA_NEON="Neon",vizuly.skin.LINEAREA_FIRE="Fire",vizuly.skin.LINEAREA_OCEAN="Ocean",vizuly.skin.LINEAREA_SUNSET="Sunset",vizuly.skin.LINEAREA_BUSINESS="Business",vizuly.theme.linearea=function(a){function b(){h()}function c(){if(i&&null!=i){var b=a.width(),c=a.height(),d=a.selection();d.attr("class",i["class"]),d.selectAll(".vz-background").attr("fill",function(){return"url(#"+j.attr("id")+")"}),d.selectAll(".vz-plot-background").style("opacity",0),d.selectAll(".vz-area").style("fill",function(a,b){return i.area_fill(a,b)}).style("fill-opacity",function(b,c){return i.area_fill_opacity.apply(a,[b,c])}),d.selectAll(".vz-line").style("stroke-width",function(){return c/450}).style("stroke",function(a,b){return i.line_stroke(a,b)}).style("opacity",function(b,c){return i.line_opacity.apply(a,[b,c])}),d.selectAll(".vz-data-point").style("opacity",0),d.selectAll(".vz-bottom-axis").style("font-weight",i.xAxis_font_weight).style("fill",i.labelColor).style("font-weight",300).style("fill-opacity",.8).style("font-size",Math.max(8,Math.round(b/65))+"px").style("opacity",function(){return b>399?1:0}),d.selectAll(".vz-left-axis line").style("stroke",i.yAxis_line_stroke).style("stroke-width",1).style("opacity",i.yAxis_line_opacity),d.selectAll(".vz-left-axis text").style("font-size",Math.max(8,Math.round(b/65))+"px").style("fill",i.labelColor).style("fill-opacity",.8),i.background_transition()}}function d(b,c,d){a.selection().selectAll(".vz-line").transition().style("stroke",function(a,b){return i.line_over_stroke(a,b)}).style("opacity",function(a,b){return b==d?1:0}),a.selection().selectAll(".vz-area").transition().style("opacity",function(a,b){return b==d?1:.35}),a.selection().selectAll(".vz-point-tip").remove();var e=d3.select(this);e.append("circle").attr("class","vz-point-tip").attr("r",4).style("fill","#000").style("stroke","#FFF").style("stroke-width",2).style("pointer-events","none")}function e(b,c,d){a.selection().selectAll(".vz-line").transition().style("stroke",function(a,b){return i.line_stroke(a,b)}).style("opacity",function(b,c){return i.line_opacity.apply(a,[b,c])}),a.selection().selectAll(".vz-area").transition().style("opacity",1),a.selection().selectAll(".vz-point-tip").remove()}function f(){a.yAxis().tickSize(-vizuly.core.util.size(a.margin(),a.width(),a.height()).width).ticks(5).orient("left"),a.xAxis().tickSize(-vizuly.core.util.size(a.margin(),a.width(),a.height()).width)}function g(){a.selection().selectAll(".vz-background").style("fill-opacity",1),j.selectAll("stop").transition().duration(500).attr("stop-color",function(a,b){return 0==b?i.grad0:i.grad1})}function h(){l.forEach(function(b){a.on(b.on,b.callback)})}var a=a,i=null,j=vizuly.svg.gradient.blend(a,"#000","#000"),k=d3.scale.category20(),l=[{on:"measure.theme",callback:f},{on:"update.theme",callback:c},{on:"mouseover.theme",callback:d},{on:"mouseout.theme",callback:e}];b(),b.apply=function(a){return arguments.length>0&&b.skin(a),c(),b},b.release=function(){a&&(a.selection().attr("class",null),l.forEach(function(b){a.on(b.on,null)}),a=null)},b.viz=function(b){return arguments.length?(a=b,void h()):a},b.skin=function(a){if(0==arguments.length)return i;if(!m[a])throw new Error("theme/linearea.js - skin "+a+" does not exist.");return i=m[a],b},b.skins=function(){return m};var m={Fire:{name:"Fire",labelColor:"#FFF",color:"#02C3FF",stroke_colors:["#FFA000","#FF5722","#F57C00","#FF9800","#FFEB3B"],fill_colors:["#C50A0A","#C2185B","#F57C00","#FF9800","#FFEB3B"],grad0:"#000000",grad1:"#474747",background_transition:g,line_stroke:function(a,b){return this.stroke_colors[b%5]},line_over_stroke:function(a,b){return d3.rgb(this.stroke_colors[b%5]).brighter()},line_opacity:function(a,b){return this.layout()==vizuly.viz.layout.STREAM?.6:.8},area_fill:function(b,c){return"url(#"+vizuly.svg.gradient.fade(a,this.fill_colors[c%5],"vertical",[.35,1]).attr("id")+")"},area_fill_opacity:function(a,b){return this.layout()==vizuly.viz.layout.OVERLAP?.7:.9},xAxis_font_weight:200,yAxis_line_stroke:"#FFF",yAxis_line_opacity:.25,data_point_stroke:function(a,b){return this.stroke_colors[b%5]},data_point_fill:function(a,b){return"#FFF"},"class":"vz-skin-default"},Sunset:{name:"Sunset",labelColor:"#D8F433",color:"#02C3FF",stroke_colors:["#CD57A4","#B236A3","#FA6F7F","#FA7C3B","#E96B6B"],fill_colors:["#89208F","#C02690","#D93256","#DB3D0C","#B2180E"],grad1:"#390E1D",grad0:"#92203A",background_transition:g,line_stroke:function(a,b){return this.stroke_colors[b%5]},line_over_stroke:function(a,b){return d3.rgb(this.stroke_colors[b%5]).brighter()},line_opacity:function(a,b){return this.layout()==vizuly.viz.layout.STREAM?.4:.9},area_fill:function(b,c){return"url(#"+vizuly.svg.gradient.fade(a,this.fill_colors[c%5],"vertical",[.5,1]).attr("id")+")"},area_fill_opacity:function(a,b){return this.layout()==vizuly.viz.layout.OVERLAP?.8:1},xAxis_font_weight:200,yAxis_line_stroke:"#D8F433",yAxis_line_opacity:.25,"class":"vz-skin-default"},Ocean:{name:"Ocean",labelColor:"#FFF",color:"#02C3FF",stroke_colors:["#001432","#001432","#001432","#001432","#001432"],grad1:"#390E1D",grad0:"#92203A",background_transition:function(b){a.selection().select(".vz-background").transition(1e3).style("fill-opacity",0)},line_stroke:function(a,b){return"#000"},line_over_stroke:function(a,b){return"#FFF"},line_opacity:function(a,b){return.3},area_fill:function(a,b){return"#FFF"},area_fill_opacity:function(b,c){return(c+1)/a.data().length*(this.layout()==vizuly.viz.layout.OVERLAP?.8:.85)},xAxis_font_weight:200,yAxis_line_stroke:"#FFF",yAxis_line_opacity:.25,"class":"vz-skin-ocean"},Neon:{name:"Neon",labelColor:"#FFF",color:"#02C3FF",stroke_colors:["#FFA000","#FF5722","#F57C00","#FF9800","#FFEB3B"],fill_colors:["#C50A0A","#C2185B","#F57C00","#FF9800","#FFEB3B"],grad0:"#000000",grad1:"#474747",background_transition:g,line_stroke:function(a,b){return"#FFF"},line_over_stroke:function(a,b){return"#FFF"},line_opacity:function(a,b){return this.layout()==vizuly.viz.layout.STREAM?.4:.6},area_fill:function(a,b){return"#D1F704"},area_fill_opacity:function(a,b){return(b+1)/this.data().length*(this.layout()==vizuly.viz.layout.OVERLAP?.6:.8)},xAxis_font_weight:200,yAxis_line_stroke:"#FFF",yAxis_line_opacity:.25,"class":"vz-skin-default"},Business:{name:"Business",labelColor:"#000",color:"#000",stroke_colors:["#FFA000","#FF5722","#F57C00","#FF9800","#FFEB3B"],fill_colors:["#C50A0A","#C2185B","#F57C00","#FF9800","#FFEB3B"],grad0:"#CCC",grad1:"#EEE",background_transition:g,line_stroke:function(a,b){return d3.rgb(k(b)).darker()},line_over_stroke:function(a,b){return"#FFF"},line_opacity:function(a,b){return.7},area_fill:function(a,b){return k(b)},area_fill_opacity:function(a,b){return this.layout()==vizuly.viz.layout.OVERLAP?.8:.9},xAxis_font_weight:200,yAxis_line_stroke:"#000",yAxis_line_opacity:.25,"class":"vz-skin-default"}};return b},vizuly.theme.radial_progress=function(a){function b(){f()}function c(){if(j){var b=a.selection();b.attr("class",j["class"]),b.selectAll(".vz-radial_progress-arc").style("fill",function(a,b){return j.arc_fill(a,b)}).style("fill-opacity",function(a,b){return j.arc_fill_opacity(a,b)}).style("stroke",function(a,b){return j.arc_stroke(a,b)}),b.selectAll(".vz-radial_progress-track").style("fill",j.track_fill),b.selectAll(".vz-radial_progress-label").style("fill",j.label_color).style("stroke-opacity",0).style("font-size",.25*a.radius())}}function d(b,c,d){a.selection().selectAll(".vz-radial_progress-label").style("font-weight",700)}function e(b,c,d){a.selection().selectAll(".vz-radial_progress-label").style("font-weight",null)}function f(){i.forEach(function(b){a.on(b.on,b.callback)})}function g(){i.forEach(function(b){a.on(b.on,null)})}var h={Alert:{name:"Alert",label_color:"#CCC",track_fill:"#DDDDDD",progress_colors:["#4CAF50","#FFC107","#FF9800","#E64A19","#FFEB3B"],arc_fill:function(a,b){return this.progress_colors[b%5]},arc_fill_opacity:function(a,b){return 1},arc_stroke:function(a,b){return this.progress_colors[b%5]},"class":"vz-skin-alert"},Fire:{name:"Fire",label_color:"#F13870",track_fill:"#DDDDDD",progress_colors:["#C50A0A","#F57C00","#FF9800","#FFEB3B","#C2185B"],arc_fill:function(a,b){return this.progress_colors[b%5]},arc_fill_opacity:function(a,b){return 1},arc_stroke:function(a,b){return this.progress_colors[b%5]},"class":"vz-skin-fire"},White:{name:"White",label_color:"#FFF",track_fill:null,arc_fill:function(a,b){return"#FFF"},arc_fill_opacity:function(a,b){return.85/Math.exp(.75*b)},arc_stroke:function(a,b){return"#FFF"},"class":"vz-skin-white"},Neon:{name:"Neon",label_color:"#D1F704",track_fill:"#000",progress_colors:["#D1F704","#A8C102","#788A04","#566204","#383F04"],arc_fill:function(a,b){return this.progress_colors[b%5]},arc_fill_opacity:function(a,b){return 1},arc_stroke:function(a,b){return this.progress_colors[b%5]},"class":"vz-skin-neon"},Business:{name:"Business",label_color:"#EEE",track_fill:"#DDDDDD",progress_colors:d3.scale.category20(),arc_fill:function(a,b){return this.progress_colors(b)},arc_fill_opacity:function(a,b){return 1},arc_stroke:function(a,b){return this.progress_colors(b)},"class":"vz-skin-business"}},a=a,i=[{on:"update.theme",callback:c},{on:"mouseover.theme",callback:d},{on:"mouseout.theme",callback:e}];b(),b.apply=function(a){return arguments.length>0&&b.skin(a),c(),b},b.release=function(){a&&(a.selection().attr("class",null),g(),a=null)},b.viz=function(b){return arguments.length?(a&&g(),a=b,void f()):a},b.skin=function(a){if(0==arguments.length)return j;if(!h[a])throw new Error("theme/linearea.js - skin "+a+" does not exist.");return j=h[a],b},b.skins=function(){return h};var j=h[vizuly.skin.RADIAL_PROGRESS_BUSINESS];return b},vizuly.skin.RADIAL_PROGRESS_FIRE="Fire",vizuly.skin.RADIAL_PROGRESS_MATERIAL="Material",vizuly.skin.RADIAL_PROGRESS_NEON="Neon",vizuly.skin.RADIAL_PROGRESS_OCEAN="Ocean",vizuly.skin.RADIAL_PROGRESS_ALERT="Alert",vizuly.skin.RADIAL_PROGRESS_BUSINESS="Business",vizuly.theme.range_input=function(a){function b(){f()}function c(){if(j){var b=a.selection();b.attr("class",j["class"]),b.selectAll(".vz-range_input-handle").style("cursor","pointer"),b.selectAll(".vz-range_input-centerpane").style("cursor","pointer"),b.selectAll(".vz-range_input-track").style("opacity",0)}}function d(a,b,c){}function e(a,b,c){}function f(){i.forEach(function(b){a.on(b.on,b.callback)})}function g(){i.forEach(function(b){a.on(b.on,null)})}var h={Default:{name:"Default",label_color:"#CCC"}},a=a,i=[{on:"update.theme",callback:c},{on:"mouseover.theme",callback:d},{on:"mouseout.theme",callback:e}];b(),b.apply=function(a){return arguments.length>0&&b.skin(a),c(),b},b.release=function(){a&&(a.selection().attr("class",null),g(),a=null)},b.viz=function(b){return arguments.length?(a&&g(),a=b,void f()):a},b.skin=function(a){if(0==arguments.length)return j;if(!h[a])throw new Error("theme/linearea.js - skin "+a+" does not exist.");return j=h[a],b},b.skins=function(){return h};var j=h.Default;return b},vizuly.skin.SCATTER_NEON="Neon",vizuly.skin.SCATTER_FIRE="Fire",vizuly.skin.SCATTER_OCEAN="Ocean",vizuly.skin.SCATTER_SUNSET="Sunset",vizuly.skin.SCATTER_BUSINESS="Business",vizuly.theme.scatter=function(a){function b(){h()}function c(){if(i){var b=a.width(),c=Math.min(a.width(),a.height())/80,d=a.selection();d.attr("class",i["class"]),d.selectAll(".vz-background").attr("fill",function(){return"url(#"+j.attr("id")+")"}),d.selectAll(".vz-plot-background").style("opacity",0),d.selectAll(".vz-scatter-bottom-axis").style("font-weight",i.xAxis_font_weight).style("fill",i.labelColor).style("font-size",Math.max(8,Math.round(b/85))+"px").style("opacity",function(){return b>399?1:0}),d.selectAll(".vz-scatter-left-axis line").style("stroke",i.yAxis_line_stroke).style("stroke-width",1).style("opacity",i.yAxis_line_opacity),d.selectAll(".vz-scatter-left-axis text").style("font-size",Math.max(8,Math.round(b/85))+"px").style("fill",i.labelColor).style("fill-opacity",.6),d.selectAll(".vz-scatter-node").style("stroke-width",c).style("stroke-opacity",0).style("stroke",function(a,b){return i.node_stroke(a,b)}).style("fill",function(a,b){return i.node_fill(a,b)}).style("fill-opacity",function(a,b){return i.node_fill_opacity(a,b)}),i.background_transition()}}function d(){a.yAxis().tickSize(-vizuly.core.util.size(a.margin(),a.width(),a.height()).width).orient("left"),a.xAxis().tickSize(-vizuly.core.util.size(a.margin(),a.width(),a.height()).width)}function e(b,c,d){a.selection().selectAll(".vz-scatter-node").style("opacity",.15),d3.select(b).style("opacity",1).style("stroke-opacity",.5).style("fill-opacity",.9),l.mouseover(b,c,d)}function f(b,c,d){d3.select(b).style("opacity",1).style("fill-opacity",function(a,b){return i.node_fill_opacity(a,b)}),a.selection().selectAll(".vz-scatter-node").style("stroke-opacity",0).style("opacity",1)}function g(){a.selection().selectAll(".vz-background").style("fill-opacity",1),j.selectAll("stop").transition().duration(500).attr("stop-color",function(a,b){return 0==b?i.grad0:i.grad1})}function h(){k.forEach(function(b){a.on(b.on,b.callback)})}var a=a,i=null,j=vizuly.svg.gradient.blend(a,"#000","#000"),k=[{on:"measure.theme",callback:d},{on:"update.theme",callback:c},{on:"mouseover.theme",callback:e},{on:"mouseout.theme",callback:f}];b(),b.apply=function(a){return arguments.length>0&&b.skin(a),c(),b},b.release=function(){a&&(a.selection().attr("class",null),k.forEach(function(b){a.on(b.on,null)}),a=null)},b.viz=function(b){return arguments.length?(a=b,void h()):a},b.skin=function(a){if(0==arguments.length)return i;if(!m[a])throw new Error("theme/linearea.js - skin "+a+" does not exist.");return i=m[a],b},b.skins=function(){return m};var l=d3.dispatch("mouseover","mouseout");b.on=function(a,c){return l.on(a,c),b};var m={Fire:{name:"Fire",labelColor:"#FFF",labelFill:"#C50A0A",stroke_colors:["#C50A0A","#C2185B","#F57C00","#FF9800","#FFEB3B"],fill_colors:["#C50A0A","#C2185B","#F57C00","#FF9800","#FFEB3B"],grad0:"#000000",grad1:"#474747",background_transition:g,yAxis_line_stroke:"#FFF",yAxis_line_opacity:.25,node_stroke:function(a,b){return this.stroke_colors[b%5]},node_fill:function(a,b){return this.fill_colors[b%5]},node_fill_opacity:function(a,b){return.5},"class":"vz-skin-fire"},Sunset:{name:"Sunset",labelColor:"#FFF",labelFill:"#00236C",stroke_colors:["#CD57A4","#B236A3","#FA6F7F","#FA7C3B","#E96B6B"],fill_colors:["#89208F","#C02690","#D93256","#DB3D0C","#B2180E"],grad1:"#390E1D",grad0:"#7C1B31",background_transition:g,yAxis_line_stroke:"#FFF",yAxis_line_opacity:.25,node_stroke:function(a,b){return this.stroke_colors[b%5]},node_fill:function(a,b){return this.fill_colors[b%5]},node_fill_opacity:function(a,b){return.7},"class":"vz-skin-sunset"},Neon:{name:"Neon",labelColor:"#FFF",labelFill:"#005",grad0:"#000000",grad1:"#474747",background_transition:g,yAxis_line_stroke:"#FFF",yAxis_line_opacity:.25,node_stroke:function(a,b){return"#FFF"},node_fill:function(a,b){return"#D1F704"},node_fill_opacity:function(a,b){return.6},"class":"vz-skin-neon"},Ocean:{name:"Ocean",labelColor:"#FFF",labelFill:"#000",background_transition:function(b){a.selection().select(".vz-background").transition(1e3).style("fill-opacity",0)},yAxis_line_stroke:"#FFF",yAxis_line_opacity:.25,node_stroke:function(a,b){return"#00F"},node_fill:function(a,b){return"#FFF"},node_fill_opacity:function(a,b){return.4},"class":"vz-skin-ocean"}};return b},vizuly.theme.weighted_tree=function(a){function b(){h()}function c(){if(o){var b=a.selection();j=Math.max(8,Math.round(a.width()/75)),b.selectAll(".vz-weighted_tree-node circle").style("stroke",function(a){return o.node_stroke(a)}).style("stroke-opacity",function(a){return o.node_stroke_opacity(a)}).style("fill",function(a){return o.node_fill(a)}).style("fill-opacity",function(a){return o.node_fill_opacity(a)}),b.selectAll(".vz-weighted_tree-node text").style("font-size",o.font_size()).style("fill",o.label_color).style("fill-opacity",function(a){return o.text_fill_opacity(a)}),b.selectAll(".vz-weighted_tree-link").style("stroke",function(a){return o.link_stroke(a)}).style("stroke-opacity",function(a){return o.link_stroke_opacity(a)})}}function d(){if(o&&a.data()){var b=a.data();a.children()(b).forEach(function(a,b){a.vz_link_color=o.link_colors[b%o.link_colors.length],e(a)}),l=!1,m=!1}}function e(b){a.children()(b)&&a.children()(b).forEach(function(a){a.vz_link_color=b.vz_link_color,e(a)})}function f(b,c,d){var e=a.selection();e.selectAll(".vz-id-"+c.vz_tree_id+" circle").style("fill-opacity",.9),e.selectAll("path.vz-id-"+c.vz_tree_id).style("stroke-opacity",.8),e.selectAll(".vz-id-"+c.vz_tree_id+" text").transition().style("font-size",1.25*j).style("font-weight","bold")}function g(b,c,d){var e=a.selection();e.selectAll(".vz-weighted_tree-node circle").style("fill",function(a){return o.node_fill(a)}).style("fill-opacity",function(a){return o.node_fill_opacity(a)}),e.selectAll(".vz-weighted_tree-node text").transition().style("font-size",j).style("font-weight","normal"),e.selectAll(".vz-weighted_tree-link").style("stroke-opacity",function(a){return o.link_stroke_opacity(a)})}function h(){n.forEach(function(b){a.on(b.on,b.callback)})}function i(){n.forEach(function(b){a.on(b.on,null)})}var j,k={Axiis:{name:"Axiis",label_color:"#333",link_colors:["#bd0026","#fecc5c","#fd8d3c","#f03b20","#B02D5D","#9B2C67","#982B9A","#692DA7","#5725AA","#4823AF","#d7b5d8","#dd1c77","#5A0C7A","#5A0C7A"],link_stroke:function(a,b){return a.target.vz_link_color},link_stroke_opacity:function(b,c){return a.value()(b.target)<=0?.15:.35},node_fill:function(a,b){return a.vz_link_color},node_fill_opacity:function(b,c){return a.value()(b)<=0?.15:.4},node_stroke:function(a,b){return a.vz_link_color},node_stroke_opacity:function(a,b){return.6},text_fill_opacity:function(b,c){return a.value()(b)<=0?.35:1},font_size:function(){return j+"px"}},None:{name:"None",label_color:null,link_colors:["#bd0026","#fecc5c","#fd8d3c","#f03b20","#B02D5D","#9B2C67","#982B9A","#692DA7","#5725AA","#4823AF","#d7b5d8","#dd1c77","#5A0C7A","#5A0C7A"],link_stroke:function(a,b){return null},link_stroke_opacity:function(a,b){return null},node_fill:function(a,b){return null},node_fill_opacity:function(a,b){return null},node_stroke:function(a,b){return null},node_stroke_opacity:function(a,b){return null},text_fill_opacity:function(a,b){return null},font_size:function(){return null}}},a=a,l=!0,m=!0,n=[{on:"update.theme",callback:c},{on:"data_prepped.theme",callback:d},{on:"mouseover.theme",callback:f},{on:"mouseout.theme",callback:g}];b(),b.apply=function(a){return arguments.length>0&&b.skin(a),c(),b},b.release=function(){a&&(o=k.None,c(),i(),a=null)},b.viz=function(b){return arguments.length?(a&&i(),a=b,void h()):a},b.skin=function(a){if(0==arguments.length)return o;if(!k[a])throw new Error("theme/weightedtree.js - skin "+a+" does not exist.");return l=!0,o=k[a],b},b.skins=function(){return k};var o=k[vizuly.skin.WEIGHTED_TREE_AXIIS];return b},vizuly.skin.WEIGHTED_TREE_AXIIS="Axiis",vizuly.ui.range_input=function(a){function b(){l=h.selection.append("svg").attr("id",h.id).style("overflow","auto").attr("class","vizuly"),m=vizuly.core.util.getDefs(j),n=l.append("rect").attr("class","vz-background"),o=l.append("g").attr("class","vz-range_input"),p=o.append("g").attr("class","vz-plot"),v=p.append("rect").attr("class","vz-range_input-track"),s=p.append("rect").attr("class","vz-range_input-sidepane"),t=p.append("rect").attr("class","vz-range_input-centerpane"),u=p.append("rect").attr("class","vz-range_input-sidepane"),q=p.append("rect").attr("class","vz-range_input-handle"),r=p.append("rect").attr("class","vz-range_input-handle"),q.call(z),r.call(A),t.call(B),h.dispatch.initialize()}function c(){j.validate(),k=vizuly.core.util.size(h.margin,h.width,h.height),y.range([0,k.width]),y.domain(h.domain),w=Math.round(k.height*h.trackHeight),x=h.handleWidth,h.dispatch.measure()}function d(){c(),l.attr("width",h.width).attr("height",h.height),n.attr("width",h.width).attr("height",h.height),p.style("width",k.width).style("height",k.height).attr("transform","translate("+k.left+","+k.top+")"),v.attr("width",k.width).attr("height",w).attr("y",(k.height-w)/2),q.attr("width",x).attr("height",k.height).attr("x",y(h.data[0])),r.attr("width",x).attr("height",k.height).attr("x",y(h.data[1])),s.attr("width",y(h.data[0])).attr("height",k.height),u.attr("width",k.width-y(h.data[1])).attr("height",k.height).attr("x",y(h.data[1])),t.attr("width",y(h.data[1])-y(h.data[0])).attr("height",k.height).attr("x",y(h.data[0])),h.dispatch.update()}function e(){var a=y.invert(d3.event.x);a=Math.min(h.data[1]-y.invert(x),Math.max(a,h.domain[0])),h.data[0]=a,h.dispatch.change(j),d()}function f(){var a=y.invert(d3.event.x);a=Math.max(h.data[0]+y.invert(x),Math.min(a,h.domain[1])),h.data[1]=a,h.dispatch.change(j),d()}function g(){var a=y.invert(d3.event.dx)+h.data[0];a=Math.min(h.data[1],Math.max(a,h.domain[0]));var b=h.data[1]-h.data[0];a=Math.min(h.domain[1]-b,a),h.data[0]=a,h.data[1]=a+b,h.dispatch.change(j),d()}var h={},i={data:[.25,.75],margin:{top:"10%",bottom:"7%",left:"8%",right:"7%"},domain:[0,1],duration:500,width:300,height:300,handleWidth:3,trackHeight:.1},j=vizuly.core.component(a,h,i,["change","handleOver","handleOut"]);j.type="viz.ui.range_input";var k,l,m,n,o,p,q,r,s,t,u,v,w,x,y=d3.scale.linear(),z=d3.behavior.drag(),A=d3.behavior.drag(),B=d3.behavior.drag();return z.on("drag",e),A.on("drag",f),B.on("drag",g),b(),j.update=function(){return d(),j},j};var data=stm_data;var id_i=0;function createIDs(o){o.id=id_i;id_i=id_i+1;if(o.children){for(i in o.children){o.id=id_i;id_i=id_i+1;createIDs(o.children[i])}}}createIDs(data);
</script>

<script>
var labeling_mode = false

function computeClustProportions(o) {
    if (o.this_root) {
        for (var i in o.children) {
            if (!o.children[i].proportion)
                computeClustProportions(o.children[i])
        }
    } else if (!o.proportion) {
        var clust_proportion = 0;
        for (var i in o.children) {
            clust_proportion += computeClustProportions(o.children[i])
        }
        o.proportion = clust_proportion;
        return clust_proportion
    } else if (o.proportion) {
        return Number(o.proportion)
    }
}

function combineMetrics(prob, frex, lift, score) {
    combined = [...frex.slice().split(', '), ...lift.slice().split(', '), ...prob.slice().split(', '), ...score.slice().split(', ')]
    result = {};
    for (var i = 0; i < combined.length; ++i) {
        if (!result[combined[i]])
            result[combined[i]] = 0;
        weight = 7 - i % 7 + 1
        result[combined[i]] += weight
    }
    return (Object.keys(result).sort(function(a, b) {
        return result[b] - result[a]
    }).join(', '))
}
var labels = {
    'topics': {},
    'clusters': {}
}
clustCount = 1;

function initLabels(o) {
    if (o.children) {
        if (!o.this_root) {
            labels.clusters[o.id.toString()] = {
                id: o.id,
                topics: o.topic_no,
                clustNum: clustCount,
                name: o.name.toString()
            };
            clustCount = clustCount + 1
        }
        for (var i in o.children) {
            initLabels(o.children[i])
        }
    } else {
        labels.topics[o.topic_no] = {
            name: o.name.toString(),
            combined: combineMetrics(o.prob[0], o.frex[0], o.lift[0], o.score[0]),
            prevalence: parseFloat(o.proportion[0])
        }
    }
}

function findWords(o) {
    if (o.children) {
        if (!o.this_root) {
            topic_prevalences = [];
            for (var i = 0; i < o.topic_no.length; i++) {
                topic_prevalences.push(labels.topics[o.topic_no[i]].prevalence)
            }
            sorted_prevs = topic_prevalences.slice().sort().reverse()
            duplicates = !0
            while (duplicates) {
                duplicates = !1
                for (var i = 0; i < sorted_prevs.length; i++) {
                    if (sorted_prevs[i] == sorted_prevs[i + 1]) {
                        to_add = 1
                        if (i > 0 && sorted_prevs[i] == Math.round(100 * sorted_prevs[i - 1]) / 100) {
                            to_add = (10000 * (sorted_prevs[i - 1] - sorted_prevs[i])) + 1
                        }
                        to_add *= 0.0001
                        topic_prevalences[topic_prevalences.indexOf(sorted_prevs[i])] = topic_prevalences[topic_prevalences.indexOf(sorted_prevs[i])] + to_add
                        sorted_prevs[i] = sorted_prevs[i] + to_add
                    }
                }
            }
            num_words_per_topic = Math.ceil(8 / o.topic_no.length)
            cluster_words = new Array(num_words_per_topic * o.topic_no.length)
            for (j = 0; j < num_words_per_topic; j++) {
                for (i = 0; i < o.topic_no.length; i++) {
                    ith_top_topic = topic_prevalences.indexOf(sorted_prevs[i])
                    cluster_words[i + j * o.topic_no.length] = labels.topics[o.topic_no[ith_top_topic]].combined.split(', ').slice(j, j + 1).toString()
                }
            }
            labels.clusters[o.id.toString()].words = cluster_words.slice(0, 8).join(', ')
        }
        for (var i in o.children) {
            findWords(o.children[i])
        }
    }
}
initLabels(data);
findWords(data);

function trimLabel(label) {
    return (String(label).length >= 27) ? String(label).substr(0, 24) + "" : label
}
var width_left;
vizuly.viz.weighted_tree = function(parent) {
    var scope = {};
    var properties = {
        "data": null,
        "margin": {
            "top": "8%",
            "bottom": "20%",
            "left": "13%",
            "right": "7%"
        },
        "width": 1280,
        "height": 900,
        "key": null,
        "tree": d3.layout.tree(),
        "children": null,
        "duration": 500,
        "value": null,
        "label": labelFunction,
        "branchPadding": -1,
        "fixedSpan": -1
    };
    var labelFunction = function(d, i) {
        return d
    };
    var viz = vizuly.core.component(parent, scope, properties, ['node_refresh', 'data_prepped']);
    viz.type = "viz.chart.weighted_tree";
    var dataIsDirty = !0;
    var refreshNeeded = !1;
    viz.on("data_change.internal", onDataChanged);
    var size;
    var tree = scope.tree;
    var nodeScale = d3.scale.sqrt();
    var root, nodes;
    var depthSpan;
    var maxDepth;
    var maxValues = {};
    var minValues = {};
    var diagonal = d3.svg.diagonal().projection(function(d) {
        return [d.y, d.x]
    });
    var nodeRadius = function(node) {
        if (node.depth == 0) return 95;
        return (Math.max(scope.value(node) * 100, 10))
    }
    var svg, g, background, plot, plotBackground, linkPlot, nodePlot, defs;
    initialize();

    function initialize() {
        scope.selection.attr("class", "vz-weighted_tree-viz");
        svg = scope.selection.append("svg").attr("id", scope.id).style("overflow", "auto").attr("class", "vizuly vz-weighted_tree-viz");
        defs = vizuly.core.util.getDefs(viz);
        background = svg.append("g").attr("class", "vz-background");
        g = svg.append("g").attr("class", "vz-weighted_tree-viz");
        plot = g.append("g").attr("class", "vz-weighted_tree-plot");
        plotBackground = plot.append("rect").attr("class", "vz-plot-background");
        linkPlot = plot.append("g").attr("class", "vz-weighted_tree-link-plot");
        nodePlot = plot.append("g").attr("class", "vz-weighted_tree-node-plot");
        scope.dispatch.initialize()
    }

    function measure() {
        viz.validate();
        size = vizuly.core.util.size(scope.margin, scope.width, scope.height * 0.8);
        tree.size([size.height, size.width]);
        if (dataIsDirty == !0 || refreshNeeded) {
            refreshData();
            if (dataIsDirty == !0) {
                function collapse(d) {
                    if (d.children) {
                        d._children = d.children;
                        d._children.forEach(collapse);
                        d.children = null
                    }
                }
                root.children.forEach(collapse)
            }
            dataIsDirty = !1;
            refreshNeeded = !1
        }
        var scale;
        if (scope.branchPadding == -1) {
            scale = Math.min(size.height, size.width) / scope.children(scope.data).length
        } else {
            scale = Math.min(size.height, size.width) * scope.branchPadding
        }
        nodeScale.range([1.5, scale / 2]);
        tree.nodeSize([scale, 0]);
        depthSpan = (scope.fixedSpan > 0) ? scope.fixedSpan : size.width / (maxDepth + 1);
        for (var i = 1; i < maxDepth + 1; i++) {
            var vals = nodes.filter(function(d) {
                return d.depth == i
            });
            maxValues[i] = d3.max(vals, function(d) {
                return scope.value(d)
            });
            minValues[i] = d3.min(vals, function(d) {
                return scope.value(d)
            })
        }
        scope.dispatch.measure()
    }

    function refreshData() {
        function setChildren(node) {
            if (scope.children(node)) {
                if (!node._children) {
                    node.children = scope.children(node);
                    node.children.forEach(function(d) {
                        d.x0 = node.x;
                        d.y0 = node.y;
                        setChildren(d)
                    })
                }
            }
        }
        maxDepth = 0;
        setChildren(scope.data);
        root = scope.data;
        root.x0 = 0;
        root.y0 = 0;
        nodes = tree.nodes(root).reverse();
        nodes.forEach(function(node) {
            if (node.depth == 0) return;
            if (!maxValues[node.depth]) {
                maxValues[node.depth] = -Infinity;
                minValues[node.depth] = Infinity
            }
            maxDepth = Math.max(maxDepth, node.depth)
        })
        scope.dispatch.data_prepped()
    }

    function onDataChanged() {
        dataIsDirty = !0
    }

    function update(refresh) {
        measure();
        svg.attr("width", scope.width).attr("height", scope.height);
        background.attr("width", scope.width).attr("height", scope.height);
        plot.style("width", size.width).style("height", size.height).attr("transform", "translate(" + size.left * 1.5 + "," + (size.top + size.height / 1.8) + ")");
        width_left = size.left * 1.5
        updateNode(root)
    }

    function updateNode(rootNode) {
        var nodes = tree(root).reverse();
        var links = tree.links(nodes);
        positionNodes(rootNode, nodes);
        var node = nodePlot.selectAll(".vz-weighted_tree-node").data(nodes, function(d) {
            return d.vz_tree_id || (d.vz_tree_id = scope.key(d))
        });
        var nodeEnter = node.enter().append("g").attr("class", function(d) {
            return "vz-weighted_tree-node vz-id-" + d.vz_tree_id
        }).attr("transform", function(d) {
            var y = d.y0 ? d.y0 : rootNode.y0;
            var x = d.x0 ? d.x0 : rootNode.x0;
            return "translate(" + y + "," + x + ")"
        }).on("click", function(d, i) {
            scope.dispatch.click(this, d, i)
        }).on("dblclick", function(d, i) {
            scope.dispatch.dblclick(this, d, i)
        }).on("mouseover", function(d, i) {
            scope.dispatch.mouseover(this, d, i)
        }).on("mouseout", function(d, i) {
            scope.dispatch.mouseout(this, d, i)
        });
        nodeEnter.append("text").attr("x", function(d) {
            return -15
        }).attr("dy", function(d) {
            if (!scope.value(d))
                return (-1)
            if (scope.value(d) <= 0.1)
                return (-15);
            x = scope.value(d)
            t = -496.6646657 * Math.pow(x, 4) + 915.0415264 * Math.pow(x, 3) - 560.372921 * Math.pow(x, 2) + 29.462983 * x - 13.84740307
            return (t)
        }).attr("text-anchor", function(d) {
            return d.children || "start"
        }).attr("id", function(d) {
            return "node_" + scope.key(d) + '_text'
        }).style("pointer-events", "none").style("fill", "#222").text(function(d) {
            if (scope.value(d)) {
                if (d.topic_no.length == 1) {
                    return (scope.label(d))
                }
                if (labels.clusters[d.id].name.split(', ').length >= 6)
                    return (trimLabel(labels.clusters[d.id].words))
                return (trimLabel(labels.clusters[d.id].name))
            }
            return ('')
        });
        nodeEnter.append("circle").attr("class", "vz-weighted_tree-node-circle").attr("r", 10).style("cursor", "pointer");
        nodeEnter.append("text").attr("x", function(d) {
            if (!scope.value(d)) return -50;
            return scope.value(d) < 0.1 ? -5 : -11
        }).attr("dy", 6).style("fill", "white").style("stroke", "white").style("pointer-events", "none").text(function(d) {
            text = Math.round(scope.value(d) * 100).toString();
            return (scope.value(d) ? text : '')
        });
        var link = linkPlot.selectAll(".vz-weighted_tree-link").data(links, function(d) {
            return d.target.vz_tree_id
        });
        link.enter().append("path").attr("class", function(d) {
            return "vz-weighted_tree-link vz-id-" + d.target.vz_tree_id
        }).attr("d", function(d) {
            var y = d.target.y0 ? d.target.y0 : rootNode.y0;
            var x = d.target.x0 ? d.target.x0 : rootNode.x0;
            var o = {
                x: x,
                y: y
            };
            return diagonal({
                source: o,
                target: o
            })
        }).on("mouseover", function(d, i) {
            scope.dispatch.mouseover(this, d, i)
        }).on("mouseout", function(d, i) {
            scope.dispatch.mouseout(this, d, i)
        }).style("stroke-linecap", "round");
        scope.dispatch.update();
        var nodeUpdate = node.transition();
        endUpdate(nodeUpdate, function() {
            scope.dispatch.node_refresh()
        });
        nodeUpdate.duration(scope.duration).attr("transform", function(d) {
            return "translate(" + d.y + "," + d.x + ")"
        });
        nodeUpdate.select("circle").attr("r", function(d) {
            return nodeRadius(d)
        });
        var nodeExit = node.exit().transition().duration(scope.duration).attr("transform", function(d) {
            d.x0 = null;
            d.y0 = null;
            return "translate(" + rootNode.y + "," + rootNode.x + ")"
        }).remove();
        nodeExit.select("circle").attr("r", 1e-6);
        nodeExit.select("text");
        link.transition().duration(scope.duration).attr("d", diagonal).style("stroke-width", function(d) {
            return nodeRadius(d.target) * 2
        });
        link.exit().transition().duration(scope.duration).attr("d", function(d) {
            var o = {
                x: rootNode.x,
                y: rootNode.y
            };
            return diagonal({
                source: o,
                target: o
            })
        }).remove();
        nodes.forEach(function(d) {
            d.x0 = d.x;
            d.y0 = d.y
        })
    }

    function positionNodes(rootNode, nodes) {
        var minY = d3.min(nodes, function(d) {
            return d.x
        });
        var maxY = d3.max(nodes, function(d) {
            return d.x
        });
        var maxX = d3.max(nodes, function(d) {
            return d.depth
        }) * depthSpan;
        var h = Math.max(scope.height, maxY - minY + size.top);
        var w = Math.max(window.innerWidth);
        if (size.height / 2 + maxY > h) h = size.height / 2 + maxY + tree.nodeSize()[0];
        svg.transition().duration(scope.duration).style("height", h + "px").style("width", w + "px");
        var offsetY = Math.max(0, -minY - size.height / 2) + tree.nodeSize()[0] / 2;
        nodes.forEach(function(d) {
            d.y = d.depth * depthSpan;
            d.x = d.x + offsetY - tree.nodeSize()[0]
        });
        scrollTop(rootNode.x)
    }

    function endUpdate(transition, callback) {
        var n = 0;
        transition.each(function() {
            ++n
        }).each("end", function() {
            if (!--n) callback.apply(this, arguments)
        })
    }

    function scrollTop(top) {
        scope.selection.transition().duration(scope.duration).tween("scrolltween", scrollTopTween(top));

        function scrollTopTween(scrollTop) {
            return function() {
                var i = d3.interpolateNumber(this.scrollTop, scrollTop);
                return function(t) {
                    this.scrollTop = i(t)
                }
            }
        }
    }

    function toggleNode(d) {
        if (d.children) {
            d._children = d.children;
            d.children = null
        } else {
            d.children = d._children;
            d._children = null
        }
        updateNode(d)
    }
    viz.update = function(refresh) {
        if (refresh == !0) refreshNeeded = !0;
        update();
        return viz
    };
    viz.toggleNode = function(d) {
        toggleNode(d)
    };
    return viz
};
vizuly.theme.weighted_tree = function(viz) {
    var skins = {
        "Axiis": {
            name: "Axiis",
            label_color: "#222",
            node_colors: ["#09f"],
            link_colors: ["#09f"],
            link_stroke: function(d, i) {
                return d.target.vz_link_color
            },
            link_stroke_opacity: function(d, i) {
                if (viz.value()(d.target) <= 0) return .15;
                return 0.4
            },
            node_fill: function(d, i) {
                return d.vz_node_color
            },
            node_fill_opacity: function(d, i) {
                if (viz.value()(d) <= 0) return .15;
                return 1
            },
            node_stroke: function(d, i) {
                return d.vz_node_color
            },
            node_stroke_opacity: function(d, i) {
                return 1
            },
            text_fill_opacity: function(d, i) {
                if (viz.value()(d) <= 0) return .35;
                return 1
            },
            font_size: function() {
                return fontSize + "px"
            }
        }
    }
    var viz = viz;
    var fontSize;
    var skinDirty = !0;
    var dataDirty = !0;
    var callbacks = [{
        on: "update.theme",
        callback: applyTheme
    }, {
        on: "data_prepped.theme",
        callback: prepColorData
    }, {
        on: "mouseover.theme",
        callback: onMouseOver
    }, {
        on: "mouseout.theme",
        callback: onMouseOut
    }];
    theme();

    function theme() {
        applyCallbacks()
    }

    function applyTheme() {
        if (!skin) return;
        var selection = viz.selection();
        min_dim = (viz.width() < viz.height() ? viz.width : viz.height())
        fontSize = Math.max(8, Math.round(viz.width() / 90));
        selection.selectAll(".vz-weighted_tree-node circle").style("stroke", function(d) {
            return skin.node_stroke(d)
        }).style("stroke-opacity", function(d) {
            return skin.node_stroke_opacity(d)
        }).style("fill", function(d) {
            return skin.node_fill(d)
        }).style("fill-opacity", function(d) {
            return skin.node_fill_opacity(d)
        });
        selection.selectAll(".vz-weighted_tree-node text").style("font-size", skin.font_size()).style("fill-opacity", function(d) {
            return skin.text_fill_opacity(d)
        });
        selection.selectAll(".vz-weighted_tree-link").style("stroke", function(d) {
            return skin.link_stroke(d)
        }).style("stroke-opacity", function(d) {
            return skin.link_stroke_opacity(d)
        })
    }

    function prepColorData() {
        if (!skin || !viz.data()) return;
        var nodes = viz.data();
        viz.children()(nodes).forEach(function(node, i) {
            node.vz_link_color = skin.link_colors[i % skin.link_colors.length];
            node.vz_node_color = skin.node_colors[i % skin.node_colors.length];
            setLinkColor(node)
        });
        skinDirty = !1;
        dataDirty = !1
    }

    function setLinkColor(node) {
        if (!viz.children()(node)) return;
        viz.children()(node).forEach(function(child) {
            child.vz_link_color = node.vz_link_color;
            child.vz_node_color = node.vz_node_color;
            setLinkColor(child)
        })
    }

    function onMouseOver(e, d, i) {
        var selection = viz.selection();
        selection.selectAll(".vz-id-" + d.vz_tree_id + " circle").style("fill-opacity", .9);
        selection.selectAll("path.vz-id-" + d.vz_tree_id).style("stroke-opacity", .8);
        selection.selectAll(".vz-id-" + d.vz_tree_id + " text").transition().style("font-size", fontSize * 1.25).style("font-weight", "bold")
    }

    function onMouseOut(e, d, i) {
        var selection = viz.selection();
        selection.selectAll(".vz-weighted_tree-node circle").style("fill", function(d) {
            return skin.node_fill(d)
        }).style("fill-opacity", function(d) {
            return skin.node_fill_opacity(d)
        })
        selection.selectAll(".vz-weighted_tree-node text").transition().style("font-size", fontSize).style("font-weight", "normal");
        selection.selectAll(".vz-weighted_tree-link").style("stroke-opacity", function(d) {
            return skin.link_stroke_opacity(d)
        })
    }

    function applyCallbacks() {
        callbacks.forEach(function(d) {
            viz.on(d.on, d.callback)
        })
    }

    function removeCallbacks() {
        callbacks.forEach(function(d) {
            viz.on(d.on, null)
        })
    }
    theme.apply = function(skin) {
        if (arguments.length > 0)
            theme.skin(skin);
        applyTheme();
        return theme
    }
    theme.release = function() {
        if (!viz) return;
        skin = skins.None;
        applyTheme();
        removeCallbacks();
        viz = null
    };
    theme.viz = function(_) {
        if (!arguments.length) {
            return viz
        }
        if (viz) {
            removeCallbacks()
        }
        viz = _;
        applyCallbacks()
    }
    theme.skin = function(_) {
        if (arguments.length == 0) {
            return skin
        }
        if (skins[_]) {
            skinDirty = !0;
            skin = skins[_]
        } else throw new Error("theme/weightedtree.js - skin " + _ + " does not exist.");
        return theme
    }
    theme.skins = function() {
        return skins
    }
    var skin = skins[vizuly.skin.WEIGHTED_TREE_AXIIS];
    return theme
}
vizuly.skin.WEIGHTED_TREE_AXIIS = "Axiis";
var viz_container;
var viz;
var theme;
toolTipIdStack = [];

function openTree(o) {
    if (o.children) {
        for (i in o.children) {
            viz.toggleNode(o.children[i])
            openTree(o.children[i])
        }
    }
}

function initialize_graph(data) {
    computeClustProportions(data);
    viz = vizuly.viz.weighted_tree(document.getElementById("viz_container"));
    theme = vizuly.theme.weighted_tree(viz).skin(vizuly.skin.WEIGHTED_TREE_AXIIS);
    console.log(data);
    viz.data(data).width(600).height(600).children(function(d) {
        return d.children
    }).key(function(d) {
        return d.id
    }).value(function(d) {
        return Number(d.proportion)
    }).fixedSpan(-1).branchPadding(-1).label(function(d) {
        return trimLabel(d.name.toString())
    }).on("measure", onMeasure).on("click", click);
    changeSize();
    openTree(data)
    console.log(data.id)
    // createDataTipQuestion(20, 20, data.name.toString(), data.summary.toString(), data.id);
    // toolTipIdStack.push(-1)
    // d3.select("body").append("div").attr('id', 'labeler').style("position", "fixed").style("top", "0%").style("left", "0%").style("opacity", 0).html('<div class="sidebar" style="display: flex; position:fixed;flex-direction: column; justify-content:center;width: ' + (width_left * 1.1) + 'px; overflow-y:scroll;top:0;bottom:0;direction:rtl;height:' + window.innerHeight + ';background-opacity:0.5">' + '<div>' + '<div class="header1 sidebar-item" style="font-size:20px;font-weight:bold; padding: 15px 15px 10px 15px">' + data.name[0] + '</div>' + '<div class="header2 sidebar-item" style="font-size: 0.66em;padding:0px 4px 5px 4px">' + data.summary[0] + ' (after removing stop words).</div>' + '<button class="sidebar-item" type="button" onclick="download(\'labels\')" style="display: block; margin: 0 auto 0 auto; font-size: 15px">download labels</button>' + '</div>' + '<div style="padding:5px"></div>' + '<div class="sidebar-rule"></div>' + '<div style="padding:10px"></div>' + '<div>' + '<div class="header2 sidebar-item" style="font-size:18px;font-weight:bold;color:#444">STM Tree Overview</div>' + '<div class="thoughts sidebar-item" style="padding: 4px 4px 15px 4px; text-align:center;font-size:15px">This is a structural topic model visualization, with hierarchical topic clusters. The leaf nodes are topics, the branching nodes are topic clusters, and the numbers are the total prevalence of the topic or cluster as a percentage all the documents. The large partially obscured node represents the entire body of texts. The clusters signify that the connected topics are more likely to co-occur in a single response (each response contains a mixture of multiple topics). Click on any node for more information.</div>' + '</div>' + '</div>').transition().style("opacity", 1)
   // creates left hand sidebar
}

function checkAllDone(str) {
    done = !0
    if (str === 'topics') {
        for (i = 1; i <= labels.topics.length; i++) {
            if ((labels.topics[i].name.toString().split(",").length - 1) === 6)
                done = !1
        }
    } else {
        for (i in labels.clusters) {
            if ((labels.clusters[i].name.toString().split(",").length - 1) === 6)
                done = !1
        }
    }
    if (done)
        console.log('done with ' + str)
}

function createDataTipTopic(x, y, prop, name, prob, frex, lift, score, thoughts, proportions, id, d) {
    var datatip_topic = '<div class="tooltip" style="display: flex; flex-direction: column; width: 20em; min-height:16.1em;max-height:20em;background-opacity:0.5"><div style="display:flex; justify-content: space-between"> <div onclick="removeToolTip(<id>)" style="align-self:flex-start;cursor:pointer;color:#888;float:left;display:inline;" alt="close">&#10005;</div>'

    if (labeling_mode) {
        datatip_topic += '<form class="pure-form"><input id="topicLabeler" placeholder="<name>"></input></form>'
    }
    else {
        datatip_topic += '<div class="header1" style="font-weight:bold;margin-right:20px"> <name> </div>'
    }

    datatip_topic += '<div></div></div><div class="scrollbox" style="overflow:auto;"><div class="header-rule" style="margin-top:0px; margin-bottom:10px"></div>'
    
    if (d.summary !== undefined) {
        datatip_topic += '<div class="header2" style="font-weight:bold;">Topic Summary</div><div class="header2"> <div style="margin: 0px 45px 0px 45px; text-align: left;"> ' + d.summary + ' </div></div><div class="header-rule" style="margin-top:0px; margin-bottom:10px"></div>'
    }
    
    datatip_topic += '<div class="header2" style="font-weight:bold;">Representative Words<sup style="color:#999" title="The most representative words calculated by various metrics (probability, frex, lift, score), then weighted and combined">?</sup></div><div class="header2"> <div style="margin: 0px 45px 0px 45px"> <words> </div></div><div class="header-rule"></div><div class="header2" style="font-weight:bold;">Representative Documents<sup style="color:#999" title="The documents containing the highest percentage of this topic (documents can contain multiple topics)">?</sup></div><div class="thought-container"> <div class="thoughts"> <doc1> </div><div class="overlay-text"> <proportion1> % representative of this topic </div></div>';

    for (i = 2; i < thoughts.length; i++) {
        datatip_topic += '<div class="header-rule-short"></div>' + '<div class="thought-container"><div class="thoughts"><doc' + i.toString() + '></div><div class="overlay-text"><proportion' + i.toString() + '>% representative of this topic</div></div>'
    }
    datatip_topic += '</div></div>';
    var html = datatip_topic.replace("<prop>", (prop * 100).toString().substr(0, 2) + '%');
    html = html.replace("<name>", name);
    html = html.replace("<id>", id);
    html = html.replace("<words>", labels.topics[d.topic_no].combined);
    for (var i = 0; i < thoughts.length; i++) {
        html = html.replace("<doc" + (i + 1).toString() + ">", thoughts[i]);
        html = html.replace("<proportion" + (i + 1).toString() + ">", (proportions[i] * 100).toFixed(1))
    }
    toolTipIdStack.push(id);

    d3.select("body").append("div").attr("class", "vz-weighted_tree-tip" + id.toString()).attr('id', 'labeler').style("position", "fixed").style("top", "15%").style("left", "40%").style("opacity", 0).html(html).transition().style("opacity", 1);
    
    if (labeling_mode)
        document.querySelector('form.pure-form').addEventListener('submit', function(e) {
            e.preventDefault();
            var nameInput = document.getElementById('topicLabeler');
            labels.topics[d.topic_no].name = nameInput.value;
            d.name = labels.topics[d.topic_no].name;
            d3.select('#node_' + id + '_text').text(nameInput.value)
            checkAllDone('topics')
        })
}

// function handleForm(d, id) {

//     document.querySelector('form.pure-form').addEventListener('submit', function(e) {
//         var nameInput = document.getElementById('topicLabeler');
//         e.preventDefault();
//         labels.topics[d.topic_no].name = nameInput.value;
//         d.name = labels.topics[d.topic_no].name;
//         d3.select('#node_' + id + '_text').text(nameInput.value)
//         console.log(nameInput)
//         console.log(nameInput.value)
//         checkAllDone('topics')
//     })
// }

function setY(y) {
    if (y > window.innerHeight - 350) {
        return (window.innerHeight - 350 + 'px')
    }
    return (y + 'px')
}

function createDataTipClust(x, y, name, words, topics, id, d) { 
    var datatip_cluster = '<div class="tooltip" style="display: flex; flex-direction: column; width: 20em; min-height:16.1em;max-height:20em;background-opacity:0.5"><div style="display:flex; justify-content: space-between"> <div onclick="removeToolTip(<id>)" style="align-self:flex-start;cursor:pointer;color:#888;float:left;display:inline;" alt="close">&#10005;</div>'
    

    if (labeling_mode) {
        datatip_cluster += '<form class="pure-form"><input id="topicLabeler" placeholder="<name>"></input></form>'
    }
    else {
        datatip_cluster += '<div class="header1" style="font-weight:bold;margin-right:20px"> <name> </div>'
    }

    datatip_cluster += '<div></div></div><div class="scrollbox" style="overflow:auto;"><div class="header-rule" style="margin-top:0px; margin-bottom:10px"></div>'    

    if (d.summary != null) {
        datatip_cluster += '<div class="header2" style="font-weight:bold;">Topic Cluster Summary</div><div class="header2"> <div style="margin: 0px 45px 0px 45px; text-align: left;"> ' + d.summary + ' </div></div><div class="header-rule" style="margin-top:0px; margin-bottom:10px"></div>'
    }
    //<div class="header-rule" style="margin-top:0px; margin-bottom:0px"></div>
    datatip_cluster += '<div class="header2" style="font-weight:bold;margin-top:10px">Cluster of Topics</div>' + '<div class="header2" id="clust_topics" style="margin-top:0px;margin-bottom:0px;list-style-type:none;display:flex;flex-direction:column;max-height:150px;overflow:auto;min-height:50px">'

    for (i in labels.clusters[id].topics)
        datatip_cluster += '<p class="header2 clust_topic" style="font-size:14px;margin:1px 0px 1px 0px">' + labels.topics[labels.clusters[id].topics[i]].name + '</p>';
    datatip_cluster = datatip_cluster.substr(0, datatip_cluster.length - 2);
    datatip_cluster += '</div></div>' + '<div class="header-rule" style="margin-top:0px"></div>' + '<div class="header2" style="font-weight:bold;">Representative Words<sup style="color:#999" title="The most representative words calculated by various metrics (probability, frex, lift, score), then weighted and combined">?</sup></div>' + '<div class="header2">' + '<div style="margin: 0px 45px 0px 45px"><words></div>' + '</div>' + '<div class="header-rule"></div>'
    if (d.thoughts != null && d.thoughts.length > 0) {
        // datatip_cluster += '<div class="header2" style="font-weight:bold;">Representative Documents<sup style="color:#999" title="The documents containing the highest percentage of this topic (documents can contain multiple topics)">?</sup></div><div class="thought-container"> <div class="thoughts"> <doc1> </div><div class="overlay-text"> <proportion1> % representative of this topic </div></div>'

        datatip_cluster += '<div class="header2" style="font-weight:bold;">Representative Documents<sup style="color:#999" title="The documents containing the highest percentage of this topic (documents can contain multiple topics)">?</sup></div><div style="max-height:17.5em;min-height:1.5em"><div class="thought-container"><div class="thoughts"><doc1></div><div class="overlay-text"><proportion1>% representative of this topic cluster, with <variance1>% total variance between topics</div></div>';
        for (i = 2; i <= d.thoughts.length; i++) {
            datatip_cluster += '<div class="header-rule-short"></div>' + '<div class="thought-container"><div class="thoughts"><doc' + i.toString() + '></div><div class="overlay-text"><proportion' + i.toString() + '>% representative of this topic cluster, with <variance' + i.toString() + '>% total variance between topics</div></div>'
        }
        for (var i = 0; i < d.thoughts.length; i++) {
            datatip_cluster = datatip_cluster.replace("<doc" + (i + 1).toString() + ">", d.thoughts[i]);
            datatip_cluster = datatip_cluster.replace("<proportion" + (i + 1).toString() + ">", (d.thought_proportions[i] * 100).toFixed(1));
            datatip_cluster = datatip_cluster.replace("<variance" + (i + 1).toString() + ">", (d.thought_variances[i] * 100).toFixed(1))
        }
    } else {
        datatip_cluster += '<div class="header2" style="font-weight:bold;">No Representative Documents Found<sup style="color:#999" title="The documents containing the highest percentage of this topic (documents can contain multiple topics)">?</sup></div>'
    }
    datatip_cluster += '</div>' + '</div>';
    datatip_cluster = datatip_cluster.replace("<name>", name);
    datatip_cluster = datatip_cluster.replace("<id>", id);
    datatip_cluster = datatip_cluster.replace("<words>", words);
    toolTipIdStack.push(id);
    d3.select("body").append("div").attr("class", "vz-weighted_tree-tip" + id.toString()).attr('id', 'labeler').style("position", "fixed").style("top", "15%").style("left", "40%").style("opacity", 0).html(datatip_cluster).transition().style("opacity", 1);

    function isOverflown(element) {
        return element.scrollHeight > element.clientHeight || element.scrollWidth > element.clientWidth
    }
    $.fn.overflown = function() {
        var e = this[0];
        return e.scrollHeight > e.clientHeight || e.scrollWidth > e.clientWidth
    }
    if ($("#clust_topics").overflown()) {
        $('.clust_topic').css('margin-left', '15px')
    }

    if (labeling_mode)
        document.querySelector('form.pure-form').addEventListener('submit', function(e) {
            e.preventDefault();
            var nameInput = document.getElementById('topicLabeler');
            labels.clusters[id].name = nameInput.value;
            d3.select('#node_' + id + '_text').text(nameInput.value)
            d.name = labels.clusters[id].name
            checkAllDone('clusters')
        })
}

function createDataTipQuestion(x, y, question, summary, id) {
    var datatip_question = '<div class="tooltip" style="display: flex; flex-direction: column; width: 20em; min-height:16.1em;max-height:20em;background-opacity:0.5">' 
      + '<div style="display:flex; justify-content: space-between">' 
         + '<div onclick="removeToolTip(<id>)" style="align-self:flex-start;cursor:pointer;color:#888;float:left;display:inline;" alt="close">&#10005;</div>' 
         + '<div class="header1" style="font-weight:bold;margin-right:20px"><question></div>' 
         + '<div></div>'
      + '</div>' 
      + '<div class="header-rule" style="margin-top:0px; margin-bottom:10px"/><div class="header2" style="font-weight:bold;"></div>' 
      + '<div class="header2"><summary>' 
         + '<div style="margin: 0px 45px 0px 45px"><words></div>' 
      + '</div>' 
      + '<div class="header-rule" style="margin-bottom:20px;"/>' 
      + '<div class="header2" style="font-weight:bold;"></div><p style="font-size:18px; margin-top:10px">Lorem ipsum set dolor</p>' 
      + '<div class="scrollbox" style="max-height:13em; overflow:auto;">';
      + '<div class="thought-container"><div class="thoughts">asdf</div></div>';
   //  var datatip_question = '<div class="tooltip" style="display:flex;flex-direction:column;align-items:center;width: 20em; background-opacity:0.5">'
   //       + '<div class="header1"><question></div>' 
   //       + '<div class="header-rule-short"></div>' 
   //       + '<div class="header2" style="font-size: 0.66em;"><summary> (after removing stop words).</div>' 
   //       + '<div class="header-rule-short"></div>' 
   //       + '<button type="button" onclick="download(\'labels\')">download labels</button>' 
   //       + '</div>'
    summary = summary.substr(0, summary.length - 1)
    var datatip_question = datatip_question.replace("<id>", id);
    var datatip_question = datatip_question.replace("<question>", question);
    var datatip_question = datatip_question.replace("<summary>", summary)
    d3.select("body").append("div")
      .attr("class", "vz-weighted_tree-tip" + id
      .toString())
      .attr('id', 'labeler')
      .style("position", "fixed")
      .style("top", "15%")
      .style("left", "40%")
      .style("opacity", 0)
      .html(datatip_question)
      .transition()
      .style("opacity", 1);

   //  d3.select("body").append("div")
   //       .attr('id', 'question')
   //       .style("position", "fixed")
   //       .style("top", "35%")
   //       .style("left", "42.5%")
   //       .style("opacity", 0)
   //       .html(datatip_question)
   //       .transition().style("opacity", 1)
}

function onMeasure() {
    viz.tree().nodeSize([60, 0])
}

function click(el, d, i) {
    onClick(el, d, i)
}
$(document).keyup(function(e) {
    if (e.keyCode == 27) {
        removeToolTip(toolTipIdStack[toolTipIdStack.length - 1])
    }
});

function removeToolTip(id) {
    val = ".vz-weighted_tree-tip" + id.toString()
    toolTipIdStack.pop()
    d3.selectAll(val).transition().style("opacity", 0).remove();
    tooltipPresent = !1
}

function onClick(e, d, i) {
    var rect = e.getBoundingClientRect();
    if (d == data) {
        createDataTipQuestion(rect.left, (rect.top + viz.height() * .05), data.name.toString(), d.summary.toString(), d.id);
        tooltipPresent = !0;
        return
    }
    if (d.target) d = d.target;
    if (d.topic_no.length === 1) {
        createDataTipTopic(rect.left, (rect.top + viz.height() * .05), d.proportion.toString(), d.name.toString(), 'Highest Probability: ' + d.prob.toString(), 'FREX: ' + d.frex.toString(), 'Lift: ' + d.lift.toString(), 'Score: ' + d.score.toString(), d.thoughts, d.thought_proportions, d.id, d)
    }
    if (d.topic_no.length !== 1 && d !== data) {
        createDataTipClust(rect.left, (rect.top + viz.height() * .05), labels.clusters[d.id].name, labels.clusters[d.id].words, d.topic_no, d.id, d)
    }
    tooltipPresent = !0
}

function download(content, fileName) {
    if (content === 'clusters')
        content = labels.clusters
    if (content === 'topics')
        content = labels.topics
    if (content === 'labels')
        content = labels
    if (content === 'data')
        content = data
    var a = document.createElement("a");
    var file = new Blob([JSON.stringify(content)], {
        type: 'application/json'
    });
    a.href = URL.createObjectURL(file);
    a.download = fileName;
    a.click()
}

function onDblClick(g, d, i) {
    viz.toggleNode(d)
}

function changeSkin(val) {
    if (val == "None") {
        theme.release()
    } else {
        theme.viz(viz);
        theme.skin(val)
    }
    viz().update()
}

function changeSize(width, height) {
    width = window.innerWidth
    height = window.innerHeight
    viz_container.transition().duration(0).style('width', '100%').style('height', '100%');
    viz.width(width).height(height).update()
}
</script>

</head>

<body>

    <div id="viz_container"></div>

    <script>
        //Once the document is ready we set javascript and page settings
        var screenWidth;
        var screenHeight;

        $(document).ready(function () {

            var rect;
            if (self==top) {
                rect = document.body.getBoundingClientRect();
            }
            else {
                rect =  parent.document.body.getBoundingClientRect();
            }

            // Set the size of our container element.
            viz_container = d3.selectAll("#viz_container")
                    .style("width", $(window).width().toString() + "px")
                    .style("height", $(window).height().toString() + "px")
                    // .on('click', removeToolTip());
            if(!stm_data.this_root)
                console.log('data loading error');
            initialize_graph(stm_data);
        });

        // function removeToolTip() {
        //   d3.selectAll(".vz-weighted_tree-tip").
        //         transition().style("opacity",0).remove();
        //   tooltipPresent = false
        //   return;
        // }

        window.addEventListener("resize", changeSize);
    </script>

  </body>
</html>
